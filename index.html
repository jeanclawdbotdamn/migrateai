<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MigrateAI ‚Äî Cross-Chain Migration Analyzer</title>
    <style>
        :root {
            --bg: #0a0e17;
            --bg2: #111827;
            --bg3: #1a2332;
            --accent: #06b6d4;
            --accent2: #8b5cf6;
            --accent3: #10b981;
            --danger: #ef4444;
            --warn: #f59e0b;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --border: #1e293b;
            --glow: rgba(6, 182, 212, 0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }
        a { color: var(--accent); text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg2), var(--bg3));
            border-bottom: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .header .subtitle {
            color: var(--text2);
            font-size: 1.1rem;
        }
        .header .badge {
            display: inline-block;
            background: var(--bg);
            border: 1px solid var(--accent);
            border-radius: 999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 0.75rem;
        }

        /* Main layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Input section */
        .input-section {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .input-section h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: end;
            margin-bottom: 1.5rem;
        }
        .input-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .input-group label {
            font-size: 0.85rem;
            color: var(--text2);
            font-weight: 500;
        }
        .input-group select, .input-group input {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-group select:focus, .input-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--glow);
        }
        .arrow-divider {
            font-size: 2rem;
            color: var(--accent);
            text-align: center;
            padding-bottom: 0.5rem;
        }
        .contract-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .contract-tag {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 0.4rem 0.9rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .contract-tag:hover { border-color: var(--accent); }
        .contract-tag.selected {
            background: rgba(6, 182, 212, 0.15);
            border-color: var(--accent);
            color: var(--accent);
        }
        .btn-analyze {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.85rem 2.5rem;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }
        .btn-analyze:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px var(--glow);
        }
        .btn-analyze:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Results */
        .results { display: none; }
        .results.visible { display: block; }

        /* Score card */
        .score-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .score-card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        .score-card .label {
            font-size: 0.8rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .score-card .value {
            font-size: 2.2rem;
            font-weight: 700;
        }
        .score-card .sub {
            font-size: 0.85rem;
            color: var(--text2);
            margin-top: 0.25rem;
        }

        /* Gauge */
        .gauge-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 0.5rem;
        }
        .gauge-svg { transform: rotate(-90deg); }
        .gauge-bg { fill: none; stroke: var(--bg); stroke-width: 8; }
        .gauge-fill {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1.5s ease-out;
        }
        .gauge-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Chain comparison */
        .chain-compare {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .chain-card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .chain-card h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .chain-stat {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        .chain-stat:last-child { border-bottom: none; }
        .chain-stat .stat-label { color: var(--text2); font-size: 0.9rem; }
        .chain-stat .stat-value { font-weight: 600; }
        .vs-divider {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }
        .trend-up { color: var(--accent3); }
        .trend-down { color: var(--danger); }
        .trend-flat { color: var(--warn); }

        /* Sections */
        .section {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .section h3 {
            font-size: 1.15rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        /* Bridge cards */
        .bridge-list { display: flex; flex-direction: column; gap: 0.75rem; }
        .bridge-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg);
            border-radius: 8px;
        }
        .bridge-item .bridge-name { font-weight: 600; }
        .bridge-item .bridge-type {
            font-size: 0.8rem;
            color: var(--text2);
            background: var(--bg3);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
        }
        .bridge-item .bridge-risk {
            font-size: 0.8rem;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .risk-low { background: rgba(16, 185, 129, 0.15); color: var(--accent3); }
        .risk-med { background: rgba(245, 158, 11, 0.15); color: var(--warn); }
        .risk-high { background: rgba(239, 68, 68, 0.15); color: var(--danger); }

        /* Challenge list */
        .challenge-item {
            padding: 0.75rem 1rem;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid;
        }
        .challenge-item.sev-HIGH { border-left-color: var(--danger); }
        .challenge-item.sev-MEDIUM { border-left-color: var(--warn); }
        .challenge-item.sev-LOW { border-left-color: var(--accent3); }
        .challenge-item .ch-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .challenge-item .ch-detail {
            font-size: 0.85rem;
            color: var(--text2);
        }

        /* Contract patterns */
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }
        .pattern-card {
            background: var(--bg);
            border-radius: 8px;
            padding: 1rem;
        }
        .pattern-card .pattern-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .pattern-card .pattern-name { font-weight: 600; }
        .pattern-card .pattern-diff {
            font-size: 0.75rem;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .diff-easy { background: rgba(16, 185, 129, 0.15); color: var(--accent3); }
        .diff-med { background: rgba(245, 158, 11, 0.15); color: var(--warn); }
        .diff-hard { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .pattern-card .pattern-arrow {
            font-size: 0.85rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        .pattern-card .pattern-notes {
            font-size: 0.8rem;
            color: var(--text2);
        }

        /* Liquidity steps */
        .liq-steps { counter-reset: step; }
        .liq-step {
            counter-increment: step;
            padding: 0.5rem 0 0.5rem 2.5rem;
            position: relative;
            font-size: 0.9rem;
        }
        .liq-step::before {
            content: counter(step);
            position: absolute;
            left: 0;
            width: 1.8rem;
            height: 1.8rem;
            background: var(--bg);
            border: 1px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: 600;
        }

        /* Recommendation */
        .recommendation {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .recommendation h3 { border-bottom: none !important; padding-bottom: 0 !important; }
        .rec-grade {
            font-size: 3rem;
            font-weight: 800;
            text-align: center;
            margin: 0.5rem 0;
        }
        .grade-A { color: var(--accent3); }
        .grade-B { color: var(--accent); }
        .grade-C { color: var(--warn); }
        .grade-D { color: var(--danger); }
        .grade-F { color: var(--danger); }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 3rem;
        }
        .loading.visible { display: block; }
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: var(--text2); }
        .loading-step {
            color: var(--accent);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text2);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .input-grid { grid-template-columns: 1fr; }
            .arrow-divider { transform: rotate(90deg); }
            .chain-compare { grid-template-columns: 1fr; }
            .vs-divider { justify-content: center; transform: rotate(90deg); }
            .header h1 { font-size: 1.8rem; }
            .score-cards { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü¶Ä MigrateAI</h1>
        <div class="subtitle">AI-Powered Cross-Chain Migration Feasibility Analyzer</div>
        <div class="badge">Powered by DeFi Llama ¬∑ WormholeScan ¬∑ Real-time Data</div>
    </div>

    <div class="container">
        <div class="input-section">
            <h2>üî¨ Analyze a Migration</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label>Source Chain (migrating FROM)</label>
                    <select id="sourceChain">
                        <option value="">Select chain...</option>
                    </select>
                </div>
                <div class="arrow-divider">‚Üí</div>
                <div class="input-group">
                    <label>Target Chain (migrating TO)</label>
                    <select id="targetChain">
                        <option value="">Select chain...</option>
                    </select>
                </div>
            </div>
            <div class="input-group" style="margin-bottom: 1rem;">
                <label>Project Name (optional)</label>
                <input type="text" id="projectName" placeholder="e.g., SpookySwap, MyProtocol">
            </div>
            <div class="input-group" style="margin-bottom: 1.5rem;">
                <label>Contract Types (click to select)</label>
                <div class="contract-tags" id="contractTags"></div>
            </div>
            <button class="btn-analyze" id="analyzeBtn" onclick="runAnalysis()">
                üîç Analyze Migration Feasibility
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">Analyzing migration feasibility...</div>
            <div class="loading-step" id="loadingStep">Fetching chain data from DeFi Llama...</div>
        </div>

        <div class="results" id="results">
            <!-- Populated by JS -->
        </div>
    </div>

    <div class="footer">
        <p><strong>MigrateAI v0.1</strong> ‚Äî Built by <a href="https://x.com/jeanclawbotdamn">@jeanclawbotdamn</a> ü¶Ä</p>
        <p>Data: <a href="https://defillama.com">DeFi Llama</a> ¬∑ <a href="https://wormholescan.io">WormholeScan</a> ¬∑ Zero dependencies ¬∑ Pure Python backend</p>
        <p style="margin-top: 0.5rem;">Built for <a href="https://solana.com/graveyardhack">Solana Graveyard Hack</a> ü™¶ ‚Üí Sunrise Track</p>
    </div>

    <script>
    // Chain data
    const CHAINS = [
        "Ethereum", "Solana", "BSC", "Polygon", "Arbitrum", "Optimism",
        "Avalanche", "Fantom", "Base", "Sui", "Aptos", "Near",
        "Cosmos", "Polkadot", "Cardano", "Tron", "TON",
        "zkSync Era", "Scroll", "Linea", "Mantle", "Manta", "Blast",
        "Starknet", "Celo", "Moonbeam", "Harmony", "Cronos"
    ];

    const CONTRACT_TYPES = [
        "ERC-20", "ERC-721", "AMM/DEX", "Lending/Borrowing", "Staking",
        "Governance/DAO", "Vault/Yield", "Bridge", "Oracle Consumer", "Multisig"
    ];

    const EVM_CHAINS = new Set(["ethereum","bsc","polygon","arbitrum","optimism","base","avalanche","fantom","zksync era","scroll","linea","mantle","manta","blast","cronos","celo","moonbeam","harmony"]);

    // Bridge data
    const BRIDGES = {
        "Wormhole": { type: "message-passing", supports: ["solana","ethereum","bsc","polygon","arbitrum","optimism","avalanche","base","sui","fantom","aptos","near"], ntt: true, sunrise: true, risk: 25 },
        "LayerZero": { type: "message-passing", supports: ["ethereum","bsc","polygon","arbitrum","optimism","avalanche","base","fantom","solana"], risk: 20 },
        "CCTP (Circle)": { type: "burn-and-mint", supports: ["ethereum","arbitrum","optimism","base","polygon","solana","avalanche"], risk: 10, note: "USDC only" },
        "Axelar": { type: "message-passing", supports: ["ethereum","polygon","avalanche","fantom","arbitrum","optimism","base","cosmos"], risk: 30 },
        "deBridge": { type: "lock-and-mint", supports: ["ethereum","bsc","polygon","arbitrum","solana","avalanche","base"], risk: 35 },
    };

    // Contract pattern data
    const PATTERNS = {
        "ERC-20": { target: "SPL Token / Token-2022", diff: 2, notes: "Direct mapping. Token-2022 adds extensions." },
        "ERC-721": { target: "Metaplex Token Standard", diff: 3, notes: "NFT = SPL token with supply of 1." },
        "AMM/DEX": { target: "Raydium CLMM / Orca Whirlpool", diff: 8, notes: "Major architecture differences." },
        "Lending/Borrowing": { target: "Solend / MarginFi / Kamino", diff: 9, notes: "Complex state management." },
        "Staking": { target: "SPL Stake Pool / Anchor staking", diff: 4, notes: "Relatively straightforward." },
        "Governance/DAO": { target: "Realms (SPL Governance) / Squads", diff: 5, notes: "Realms is the standard." },
        "Vault/Yield": { target: "Kamino / Custom Anchor vault", diff: 6, notes: "No ERC-4626 on Solana." },
        "Bridge": { target: "Wormhole NTT / Custom program", diff: 9, notes: "Use NTT SDK for standard needs." },
        "Oracle Consumer": { target: "Pyth / Switchboard", diff: 2, notes: "Drop-in Chainlink replacement." },
        "Multisig": { target: "Squads v4", diff: 2, notes: "Well-audited, widely used." },
    };

    // DEX ecosystems
    const DEX_MAP = {
        "solana": ["Jupiter", "Raydium", "Orca", "Meteora", "Phoenix"],
        "ethereum": ["Uniswap", "Curve", "Balancer", "SushiSwap"],
        "bsc": ["PancakeSwap", "Venus", "Thena"],
        "polygon": ["QuickSwap", "Uniswap", "Balancer"],
        "arbitrum": ["GMX", "Camelot", "Uniswap", "Trader Joe"],
        "optimism": ["Velodrome", "Uniswap", "Synthetix"],
        "avalanche": ["Trader Joe", "Pangolin", "Curve"],
        "fantom": ["SpookySwap", "Beethoven X", "Equalizer"],
        "base": ["Aerodrome", "Uniswap", "BaseSwap"],
    };

    let selectedContracts = new Set();
    let chainData = {};

    // Initialize
    function init() {
        const srcSel = document.getElementById('sourceChain');
        const tgtSel = document.getElementById('targetChain');
        CHAINS.forEach(c => {
            srcSel.innerHTML += `<option value="${c.toLowerCase()}">${c}</option>`;
            tgtSel.innerHTML += `<option value="${c.toLowerCase()}">${c}</option>`;
        });
        // Defaults
        srcSel.value = "fantom";
        tgtSel.value = "solana";

        const tags = document.getElementById('contractTags');
        CONTRACT_TYPES.forEach(ct => {
            const tag = document.createElement('div');
            tag.className = 'contract-tag';
            tag.textContent = ct;
            tag.onclick = () => {
                tag.classList.toggle('selected');
                if (selectedContracts.has(ct)) selectedContracts.delete(ct);
                else selectedContracts.add(ct);
            };
            tags.appendChild(tag);
        });

        // Pre-fetch chain data
        fetchChainData();
    }

    async function fetchChainData() {
        try {
            const res = await fetch('https://api.llama.fi/v2/chains');
            const chains = await res.json();
            chains.forEach(c => {
                chainData[c.name.toLowerCase()] = {
                    name: c.name,
                    tvl: c.tvl || 0,
                    tokenSymbol: c.tokenSymbol || '',
                };
            });
        } catch(e) {
            console.log('DeFi Llama prefetch failed, using cached data');
        }
    }

    async function runAnalysis() {
        const source = document.getElementById('sourceChain').value;
        const target = document.getElementById('targetChain').value;
        const project = document.getElementById('projectName').value || 'Your Project';

        if (!source || !target) { alert('Please select both chains'); return; }
        if (source === target) { alert('Source and target must be different'); return; }

        const btn = document.getElementById('analyzeBtn');
        btn.disabled = true;
        btn.textContent = '‚è≥ Analyzing...';

        document.getElementById('loading').classList.add('visible');
        document.getElementById('results').classList.remove('visible');

        const steps = [
            'Fetching chain health data from DeFi Llama...',
            'Querying WormholeScan bridge data...',
            'Analyzing bridge routes and risks...',
            'Evaluating contract migration complexity...',
            'Scoring token migration feasibility...',
            'Generating migration playbook...',
        ];

        let stepIdx = 0;
        const stepInterval = setInterval(() => {
            stepIdx = Math.min(stepIdx + 1, steps.length - 1);
            document.getElementById('loadingStep').textContent = steps[stepIdx];
        }, 800);

        try {
            // Fetch real chain data
            const [chainsRes, bridgesRes, whRes] = await Promise.allSettled([
                fetch('https://api.llama.fi/v2/chains').then(r => r.json()),
                fetch('https://bridges.llama.fi/bridges?includeChains=true').then(r => r.json()),
                fetch('https://api.wormholescan.io/api/v1/scorecards').then(r => r.json()),
            ]);

            const chains = chainsRes.status === 'fulfilled' ? chainsRes.value : [];
            const bridges = bridgesRes.status === 'fulfilled' ? bridgesRes.value.bridges || [] : [];
            const wormhole = whRes.status === 'fulfilled' ? whRes.value : {};

            // Process chain data
            const srcChain = findChain(chains, source);
            const tgtChain = findChain(chains, target);

            // Fetch TVL history for trend
            const [srcHistRes, tgtHistRes] = await Promise.allSettled([
                fetch(`https://api.llama.fi/v2/historicalChainTvl/${encodeURIComponent(srcChain?.name || source)}`).then(r => r.json()),
                fetch(`https://api.llama.fi/v2/historicalChainTvl/${encodeURIComponent(tgtChain?.name || target)}`).then(r => r.json()),
            ]);

            const srcHist = srcHistRes.status === 'fulfilled' ? srcHistRes.value : [];
            const tgtHist = tgtHistRes.status === 'fulfilled' ? tgtHistRes.value : [];

            const srcTrend = calcTrend(srcHist);
            const tgtTrend = calcTrend(tgtHist);

            // Compute scores
            const feasibility = computeFeasibility(srcChain, tgtChain, srcTrend, tgtTrend, source, target);
            const avBridges = findBridges(source, target);
            const riskScore = computeRisk(srcChain, tgtChain, srcTrend, source, target, avBridges);
            const contractAnalysis = analyzeContracts(Array.from(selectedContracts), source, target);

            clearInterval(stepInterval);
            document.getElementById('loading').classList.remove('visible');

            renderResults({
                source, target, project,
                srcChain, tgtChain,
                srcTrend, tgtTrend,
                feasibility, avBridges,
                riskScore, contractAnalysis,
                wormhole,
            });

            document.getElementById('results').classList.add('visible');
        } catch(e) {
            clearInterval(stepInterval);
            console.error(e);
            document.getElementById('loading').classList.remove('visible');
            alert('Analysis failed: ' + e.message);
        }

        btn.disabled = false;
        btn.textContent = 'üîç Analyze Migration Feasibility';
    }

    function findChain(chains, name) {
        const n = name.toLowerCase();
        return chains.find(c => c.name.toLowerCase() === n) ||
               chains.find(c => (c.tokenSymbol || '').toLowerCase() === n) ||
               { name: name, tvl: 0 };
    }

    function calcTrend(history) {
        if (!Array.isArray(history) || history.length < 30) return { change30d: 0, trend: 'unknown' };
        const now = history[history.length - 1]?.tvl || 0;
        const d30 = history[Math.max(0, history.length - 31)]?.tvl || 1;
        const change = ((now - d30) / d30) * 100;
        return {
            change30d: change,
            trend: change > 5 ? 'growing' : change < -5 ? 'declining' : 'stable',
        };
    }

    function computeFeasibility(src, tgt, srcT, tgtT, srcName, tgtName) {
        let score = 50;
        // Target TVL boost
        if ((tgt?.tvl || 0) > 1e9) score += 15;
        else if ((tgt?.tvl || 0) > 100e6) score += 10;
        // Source declining = migration signal
        if (srcT.trend === 'declining') score += 10;
        // Target growing
        if (tgtT.trend === 'growing') score += 10;
        else if (tgtT.trend === 'declining') score -= 10;
        // Bridge availability
        const bridges = findBridges(srcName, tgtName);
        if (bridges.length >= 3) score += 10;
        else if (bridges.length === 0) score -= 20;
        // Cross-VM penalty
        const srcEvm = EVM_CHAINS.has(srcName);
        const tgtEvm = EVM_CHAINS.has(tgtName);
        if (srcEvm !== tgtEvm) score -= 10;

        score = Math.max(0, Math.min(100, score));
        const grade = score >= 80 ? 'A' : score >= 65 ? 'B' : score >= 45 ? 'C' : score >= 30 ? 'D' : 'F';
        return { score, grade };
    }

    function findBridges(src, tgt) {
        const s = src.toLowerCase(), t = tgt.toLowerCase();
        return Object.entries(BRIDGES)
            .filter(([_, b]) => b.supports.includes(s) && b.supports.includes(t))
            .map(([name, b]) => ({ name, ...b }))
            .sort((a, b) => a.risk - b.risk);
    }

    function computeRisk(src, tgt, srcTrend, srcName, tgtName, bridges) {
        let score = 30;
        const challenges = [];

        // Cross-VM
        const srcEvm = EVM_CHAINS.has(srcName);
        const tgtSolana = tgtName === 'solana';
        if (srcEvm && tgtSolana) {
            score += 25;
            challenges.push({ severity: 'HIGH', issue: 'Cross-VM Migration (EVM ‚Üí SVM)', detail: 'Requires full contract rewrite from Solidity to Rust/Anchor. Different execution model.' });
        } else if (srcEvm && !EVM_CHAINS.has(tgtName)) {
            score += 20;
            challenges.push({ severity: 'HIGH', issue: 'Cross-VM Migration', detail: 'Different virtual machines require significant code changes.' });
        }

        // Bridge risk
        if (bridges.length === 0) {
            score += 25;
            challenges.push({ severity: 'HIGH', issue: 'No Standard Bridge', detail: 'No major bridge supports this chain pair.' });
        } else if (bridges[0].risk > 30) {
            score += 10;
            challenges.push({ severity: 'MEDIUM', issue: 'Bridge Risk', detail: `Best available bridge (${bridges[0].name}) has elevated risk.` });
        }

        // Declining target
        if (srcTrend.trend === 'declining' && srcTrend.change30d < -20) {
            score += 5;
            challenges.push({ severity: 'MEDIUM', issue: 'Rapid Source Decline', detail: `Source chain TVL dropped ${srcTrend.change30d.toFixed(1)}% in 30 days. Urgency increases risk of mistakes.` });
        }

        // Liquidity
        if ((tgt?.tvl || 0) < 10e6) {
            score += 15;
            challenges.push({ severity: 'HIGH', issue: 'Low Target Liquidity', detail: 'Target chain has very low TVL. Liquidity bootstrapping will be challenging.' });
        }

        // Contract complexity
        if (selectedContracts.size > 0) {
            const maxDiff = Math.max(...Array.from(selectedContracts).map(c => (PATTERNS[c]?.diff || 5)));
            if (maxDiff >= 8) {
                score += 15;
                challenges.push({ severity: 'HIGH', issue: 'Complex Contract Types', detail: 'Your project includes highly complex contract patterns that require expert-level migration.' });
            } else if (maxDiff >= 5) {
                score += 5;
                challenges.push({ severity: 'MEDIUM', issue: 'Moderate Contract Complexity', detail: 'Some contract patterns require significant redesign.' });
            }
        }

        score = Math.min(100, score);
        const level = score < 30 ? 'LOW' : score < 50 ? 'MODERATE' : score < 70 ? 'HIGH' : 'CRITICAL';
        return { score, level, challenges };
    }

    function analyzeContracts(types, source, target) {
        if (types.length === 0) return null;
        const patterns = types.map(t => ({ type: t, ...(PATTERNS[t] || { target: 'Custom', diff: 7, notes: 'Custom implementation' }) }));
        const maxDiff = Math.max(...patterns.map(p => p.diff));
        const avgDiff = patterns.reduce((s, p) => s + p.diff, 0) / patterns.length;
        const overall = Math.round(avgDiff * 0.3 + maxDiff * 0.7);
        const weeks = overall <= 3 ? '2-4' : overall <= 6 ? '4-8' : overall <= 8 ? '8-16' : '16-24+';
        return { patterns, overall, maxDiff, weeks, bottleneck: patterns.reduce((a, b) => a.diff > b.diff ? a : b).type };
    }

    function fmt(n) {
        if (n >= 1e9) return `$${(n/1e9).toFixed(2)}B`;
        if (n >= 1e6) return `$${(n/1e6).toFixed(1)}M`;
        if (n >= 1e3) return `$${(n/1e3).toFixed(0)}K`;
        return `$${n.toFixed(0)}`;
    }

    function trendClass(trend) {
        return trend === 'growing' ? 'trend-up' : trend === 'declining' ? 'trend-down' : 'trend-flat';
    }

    function trendIcon(trend) {
        return trend === 'growing' ? 'üìà' : trend === 'declining' ? 'üìâ' : '‚û°Ô∏è';
    }

    function gaugeHTML(id, value, max, color) {
        const r = 50, c = 2 * Math.PI * r;
        const pct = Math.min(value / max, 1);
        return `<div class="gauge-container">
            <svg class="gauge-svg" width="120" height="120" viewBox="0 0 120 120">
                <circle class="gauge-bg" cx="60" cy="60" r="${r}"/>
                <circle class="gauge-fill" cx="60" cy="60" r="${r}"
                    stroke="${color}" stroke-dasharray="${c}" stroke-dashoffset="${c * (1 - pct)}"
                    style="transition: stroke-dashoffset 1.5s ease-out"/>
            </svg>
            <div class="gauge-text" style="color:${color}">${value}</div>
        </div>`;
    }

    function renderResults(data) {
        const { source, target, project, srcChain, tgtChain, srcTrend, tgtTrend,
                feasibility, avBridges, riskScore, contractAnalysis, wormhole } = data;

        const fColor = feasibility.score >= 65 ? '#10b981' : feasibility.score >= 45 ? '#f59e0b' : '#ef4444';
        const rColor = riskScore.score < 40 ? '#10b981' : riskScore.score < 60 ? '#f59e0b' : '#ef4444';
        const srcName = srcChain?.name || source;
        const tgtName = tgtChain?.name || target;

        let html = `
        <!-- Score Cards -->
        <div class="score-cards">
            <div class="score-card">
                <div class="label">Feasibility</div>
                ${gaugeHTML('fGauge', feasibility.score, 100, fColor)}
                <div class="sub">Grade ${feasibility.grade}</div>
            </div>
            <div class="score-card">
                <div class="label">Risk Level</div>
                ${gaugeHTML('rGauge', riskScore.score, 100, rColor)}
                <div class="sub">${riskScore.level}</div>
            </div>
            <div class="score-card">
                <div class="label">Bridge Routes</div>
                <div class="value" style="color:${avBridges.length > 0 ? 'var(--accent3)' : 'var(--danger)'}">${avBridges.length}</div>
                <div class="sub">available</div>
            </div>
            <div class="score-card">
                <div class="label">Wormhole 24h</div>
                <div class="value" style="color:var(--accent);font-size:1.4rem">${wormhole['24h_volume'] ? fmt(parseFloat(wormhole['24h_volume'])) : 'N/A'}</div>
                <div class="sub">volume</div>
            </div>
        </div>

        <!-- Recommendation -->
        <div class="recommendation">
            <h3>üìã Recommendation: ${project}</h3>
            <div class="rec-grade grade-${feasibility.grade}">${feasibility.grade}</div>
            <p style="text-align:center;color:var(--text2)">
                ${feasibility.score >= 65 ? 'Strong migration case. Target chain offers significant advantages.' :
                  feasibility.score >= 45 ? 'Moderate migration case. Benefits exist but weigh carefully against costs.' :
                  'Weak migration case. Significant challenges may outweigh benefits.'}
                ${avBridges.some(b => b.sunrise) ? '<br>‚ú® <strong>Wormhole Sunrise available</strong> ‚Äî canonical asset onboarding with day-one liquidity.' : ''}
            </p>
        </div>

        <!-- Chain Comparison -->
        <div class="chain-compare">
            <div class="chain-card">
                <h3>üì§ ${srcName}</h3>
                <div class="chain-stat">
                    <span class="stat-label">TVL</span>
                    <span class="stat-value">${fmt(srcChain?.tvl || 0)}</span>
                </div>
                <div class="chain-stat">
                    <span class="stat-label">30d Change</span>
                    <span class="stat-value ${trendClass(srcTrend.trend)}">${srcTrend.change30d.toFixed(1)}% ${trendIcon(srcTrend.trend)}</span>
                </div>
                <div class="chain-stat">
                    <span class="stat-label">DEXes</span>
                    <span class="stat-value">${(DEX_MAP[source] || ['Unknown']).slice(0,3).join(', ')}</span>
                </div>
            </div>
            <div class="vs-divider">‚Üí</div>
            <div class="chain-card">
                <h3>üì• ${tgtName}</h3>
                <div class="chain-stat">
                    <span class="stat-label">TVL</span>
                    <span class="stat-value">${fmt(tgtChain?.tvl || 0)}</span>
                </div>
                <div class="chain-stat">
                    <span class="stat-label">30d Change</span>
                    <span class="stat-value ${trendClass(tgtTrend.trend)}">${tgtTrend.change30d.toFixed(1)}% ${trendIcon(tgtTrend.trend)}</span>
                </div>
                <div class="chain-stat">
                    <span class="stat-label">DEXes</span>
                    <span class="stat-value">${(DEX_MAP[target] || ['Unknown']).slice(0,3).join(', ')}</span>
                </div>
            </div>
        </div>

        <!-- Bridge Routes -->
        <div class="section">
            <h3>üåâ Available Bridge Routes (${avBridges.length})</h3>
            <div class="bridge-list">
                ${avBridges.length === 0 ? '<p style="color:var(--danger)">‚ö†Ô∏è No standard bridges support this chain pair.</p>' :
                  avBridges.map(b => `
                    <div class="bridge-item">
                        <span class="bridge-name">${b.name}${b.ntt ? ' üåÖ' : ''}${b.note ? ` (${b.note})` : ''}</span>
                        <span class="bridge-type">${b.type}</span>
                        <span class="bridge-risk ${b.risk < 20 ? 'risk-low' : b.risk < 35 ? 'risk-med' : 'risk-high'}">${b.risk < 20 ? 'Low Risk' : b.risk < 35 ? 'Med Risk' : 'High Risk'}</span>
                    </div>
                  `).join('')}
            </div>
            ${avBridges.some(b => b.sunrise) ? '<p style="margin-top:1rem;color:var(--accent)">‚ú® Wormhole Sunrise: Canonical route for external assets entering Solana with day-one liquidity via NTT (Native Token Transfer).</p>' : ''}
        </div>

        <!-- Risk Challenges -->
        ${riskScore.challenges.length > 0 ? `
        <div class="section">
            <h3>‚ö†Ô∏è Key Challenges (${riskScore.challenges.length})</h3>
            ${riskScore.challenges.map(c => `
                <div class="challenge-item sev-${c.severity}">
                    <div class="ch-title">${c.severity === 'HIGH' ? 'üî¥' : c.severity === 'MEDIUM' ? 'üü°' : 'üü¢'} ${c.issue} (${c.severity})</div>
                    <div class="ch-detail">${c.detail}</div>
                </div>
            `).join('')}
        </div>` : ''}`;

        // Contract analysis
        if (contractAnalysis) {
            html += `
            <div class="section">
                <h3>üìù Contract Migration Analysis (${contractAnalysis.overall}/10 difficulty, ~${contractAnalysis.weeks} weeks)</h3>
                <p style="color:var(--text2);margin-bottom:1rem">Bottleneck: <strong>${contractAnalysis.bottleneck}</strong></p>
                <div class="pattern-grid">
                    ${contractAnalysis.patterns.map(p => `
                        <div class="pattern-card">
                            <div class="pattern-header">
                                <span class="pattern-name">${p.type}</span>
                                <span class="pattern-diff ${p.diff <= 3 ? 'diff-easy' : p.diff <= 6 ? 'diff-med' : 'diff-hard'}">${p.diff}/10</span>
                            </div>
                            <div class="pattern-arrow">‚Üí ${p.target}</div>
                            <div class="pattern-notes">${p.notes}</div>
                        </div>
                    `).join('')}
                </div>
            </div>`;
        }

        // Liquidity plan
        const liqSteps = target === 'solana' ? [
            'Deploy SPL token (or Token-2022 for extensions)',
            'Seed liquidity on Jupiter via Meteora or Orca CLMM',
            'Apply for Jupiter Verified Token List',
            'Set up Raydium CPMM pool for stable liquidity',
            'Register on Solana token registry',
        ] : EVM_CHAINS.has(target) ? [
            'Deploy ERC-20 token contract',
            `Create Uniswap V3 pool on ${tgtName}`,
            'Seed initial liquidity ($10K+ recommended)',
            'Register on token lists (Uniswap, CoinGecko)',
        ] : [
            `Deploy token on ${tgtName}`,
            `Create pool on primary DEX`,
            'Seed initial liquidity',
        ];

        html += `
        <div class="section">
            <h3>üíß Liquidity Bootstrapping Plan</h3>
            <div class="liq-steps">
                ${liqSteps.map(s => `<div class="liq-step">${s}</div>`).join('')}
            </div>
        </div>`;

        document.getElementById('results').innerHTML = html;
    }

    // Init on load
    init();
    </script>
</body>
</html>
