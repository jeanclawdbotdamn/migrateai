<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MigrateAI ‚Äî AI-Powered Cross-Chain Migration Analyzer</title>
<meta name="description" content="Analyze cross-chain migration feasibility with real-time data from DeFi Llama and WormholeScan. Free, open source, zero dependencies.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--bg2:#0f1320;--bg3:#161c2e;--bg4:#1e2742;
  --text:#e8edf5;--text2:#8b97b0;--text3:#556177;
  --cyan:#06d6a0;--blue:#4cc9f0;--purple:#7b61ff;--pink:#f72585;
  --amber:#fbbf24;--red:#ef4444;--green:#10b981;
  --border:rgba(255,255,255,0.06);--glass:rgba(15,19,32,0.8);
  --r:12px;--r-lg:20px;
}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;line-height:1.6}
a{color:var(--blue);text-decoration:none}a:hover{text-decoration:underline}
code,.mono{font-family:'JetBrains Mono',monospace}

/* ===== Background ===== */
.bg-mesh{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.bg-mesh .orb{position:absolute;border-radius:50%;filter:blur(120px);opacity:.12;animation:orbFloat 20s ease-in-out infinite}
.bg-mesh .orb:nth-child(1){width:600px;height:600px;background:var(--purple);top:-10%;left:-5%;animation-delay:0s}
.bg-mesh .orb:nth-child(2){width:500px;height:500px;background:var(--cyan);bottom:-10%;right:-5%;animation-delay:-7s}
.bg-mesh .orb:nth-child(3){width:400px;height:400px;background:var(--blue);top:40%;left:50%;animation-delay:-14s}
@keyframes orbFloat{0%,100%{transform:translate(0,0)}33%{transform:translate(30px,-40px)}66%{transform:translate(-20px,30px)}}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:radial-gradient(circle at 1px 1px,rgba(255,255,255,.02) 1px,transparent 0);
  background-size:48px 48px}

/* ===== Layout ===== */
.wrap{position:relative;z-index:1}
.container{max-width:1200px;margin:0 auto;padding:0 24px}

/* ===== Hero ===== */
.hero{padding:60px 0 50px;text-align:center}
.hero-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(6,214,160,.08);border:1px solid rgba(6,214,160,.2);border-radius:999px;padding:6px 16px;font-size:.78rem;color:var(--cyan);margin-bottom:20px;backdrop-filter:blur(8px)}
.hero h1{font-size:clamp(2.2rem,5vw,3.8rem);font-weight:900;letter-spacing:-1.5px;line-height:1.1;margin-bottom:12px}
.hero h1 .grad{background:linear-gradient(135deg,var(--cyan),var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero .sub{color:var(--text2);font-size:clamp(.95rem,2vw,1.15rem);max-width:640px;margin:0 auto 28px;font-weight:300}
.hero-stats{display:flex;justify-content:center;gap:40px;flex-wrap:wrap}
.hero-stat{text-align:center}
.hero-stat .num{font-size:1.6rem;font-weight:800;color:var(--cyan)}
.hero-stat .lbl{font-size:.75rem;color:var(--text3);text-transform:uppercase;letter-spacing:.06em}

/* ===== Nav Tabs ===== */
.nav-tabs{display:flex;gap:4px;border-bottom:1px solid var(--border);padding:0 0 0;margin-bottom:32px;overflow-x:auto}
.nav-tab{padding:12px 20px;font-size:.88rem;font-weight:500;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap;user-select:none}
.nav-tab:hover{color:var(--text2)}
.nav-tab.active{color:var(--cyan);border-bottom-color:var(--cyan)}
.tab-panel{display:none}.tab-panel.active{display:block}

/* ===== Glass Card ===== */
.card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:var(--r-lg);padding:28px;margin-bottom:24px}
.card-sm{padding:20px;border-radius:var(--r)}
.card h2{font-size:1.3rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.card h3{font-size:1.05rem;font-weight:600;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--border)}

/* ===== Input Form ===== */
.form-grid{display:grid;grid-template-columns:1fr 48px 1fr;gap:16px;align-items:end;margin-bottom:20px}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-group label{font-size:.8rem;color:var(--text2);font-weight:500;text-transform:uppercase;letter-spacing:.04em}
.form-input,.form-select{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 16px;color:var(--text);font-size:.95rem;font-family:inherit;outline:none;transition:border-color .2s,box-shadow .2s;width:100%}
.form-input:focus,.form-select:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(6,214,160,.1)}
.form-input::placeholder{color:var(--text3)}
.form-select option{background:var(--bg2);color:var(--text)}
.arrow-sep{display:flex;align-items:center;justify-content:center;font-size:1.8rem;color:var(--cyan);padding-bottom:6px}

/* Tags */
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px}
.tag{background:var(--bg);border:1px solid var(--border);border-radius:999px;padding:8px 16px;font-size:.82rem;cursor:pointer;transition:all .2s;user-select:none}
.tag:hover{border-color:rgba(6,214,160,.4)}
.tag.on{background:rgba(6,214,160,.1);border-color:var(--cyan);color:var(--cyan)}

/* Button */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:none;border-radius:10px;padding:14px 32px;font-size:1rem;font-weight:600;font-family:inherit;cursor:pointer;transition:all .25s;text-decoration:none}
.btn-primary{background:linear-gradient(135deg,var(--cyan),var(--blue));color:#000;width:100%}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(6,214,160,.2)}
.btn-primary:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
.btn-sm{padding:8px 16px;font-size:.82rem;border-radius:8px}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text2)}
.btn-outline:hover{border-color:var(--cyan);color:var(--cyan)}
.btn-ghost{background:rgba(255,255,255,.04);border:1px solid var(--border);color:var(--text2)}
.btn-ghost:hover{background:rgba(255,255,255,.08);color:var(--text)}

/* ===== Score Cards ===== */
.scores{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:24px}
.score-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:20px;text-align:center}
.score-box .lbl{font-size:.72rem;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.score-box .val{font-size:2.4rem;font-weight:800;line-height:1}
.score-box .sub{font-size:.82rem;color:var(--text2);margin-top:6px}

/* Gauge ring */
.gauge{position:relative;width:100px;height:100px;margin:0 auto 8px}
.gauge svg{transform:rotate(-90deg)}
.gauge .bg{fill:none;stroke:var(--bg);stroke-width:6}
.gauge .fill{fill:none;stroke-width:6;stroke-linecap:round;transition:stroke-dashoffset 1.2s cubic-bezier(.4,0,.2,1)}
.gauge .center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:1.6rem;font-weight:800}

/* ===== Chain Compare ===== */
.compare{display:grid;grid-template-columns:1fr 48px 1fr;gap:20px;margin-bottom:24px}
.chain-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:20px}
.chain-box h4{font-size:1rem;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.chain-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:.9rem}
.chain-row:last-child{border-bottom:none}
.chain-row .k{color:var(--text2)}.chain-row .v{font-weight:600}
.vs{display:flex;align-items:center;justify-content:center;font-size:1.4rem;font-weight:800;color:var(--purple)}
.up{color:var(--green)}.down{color:var(--red)}.flat{color:var(--amber)}

/* ===== Bridge List ===== */
.bridge-row{display:flex;align-items:center;justify-content:space-between;background:var(--bg);border-radius:8px;padding:12px 16px;margin-bottom:8px}
.bridge-row .name{font-weight:600;font-size:.92rem}
.bridge-row .type{font-size:.75rem;color:var(--text3);background:var(--bg3);padding:3px 8px;border-radius:4px;margin-left:8px}
.bridge-row .risk{font-size:.75rem;font-weight:600;padding:3px 10px;border-radius:4px}
.rk-lo{background:rgba(16,185,129,.1);color:var(--green)}
.rk-md{background:rgba(251,191,36,.1);color:var(--amber)}
.rk-hi{background:rgba(239,68,68,.1);color:var(--red)}

/* ===== Challenge Items ===== */
.ch-item{background:var(--bg);border-radius:8px;padding:14px 16px;margin-bottom:8px;border-left:3px solid}
.ch-HIGH{border-left-color:var(--red)}.ch-MEDIUM{border-left-color:var(--amber)}.ch-LOW{border-left-color:var(--green)}
.ch-item .title{font-weight:600;font-size:.9rem;margin-bottom:4px}
.ch-item .detail{font-size:.82rem;color:var(--text2)}

/* ===== Pattern Grid ===== */
.pat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.pat-card{background:var(--bg);border-radius:8px;padding:14px}
.pat-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.pat-name{font-weight:600;font-size:.9rem}
.pat-diff{font-size:.72rem;font-weight:600;padding:2px 8px;border-radius:4px}
.d-easy{background:rgba(16,185,129,.12);color:var(--green)}
.d-med{background:rgba(251,191,36,.12);color:var(--amber)}
.d-hard{background:rgba(239,68,68,.12);color:var(--red)}
.pat-arrow{font-size:.82rem;color:var(--blue);margin-bottom:4px}
.pat-notes{font-size:.78rem;color:var(--text2)}

/* ===== Steps ===== */
.steps{counter-reset:s}
.step{counter-increment:s;padding:6px 0 6px 36px;position:relative;font-size:.88rem}
.step::before{content:counter(s);position:absolute;left:0;width:24px;height:24px;background:var(--bg);border:1px solid var(--cyan);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.72rem;color:var(--cyan);font-weight:600}

/* ===== Playbook Timeline ===== */
.timeline{position:relative;padding-left:32px}
.timeline::before{content:'';position:absolute;left:11px;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,var(--cyan),var(--purple))}
.tl-item{position:relative;margin-bottom:28px}
.tl-dot{position:absolute;left:-32px;top:2px;width:24px;height:24px;border-radius:50%;border:2px solid var(--cyan);background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;color:var(--cyan)}
.tl-item h4{font-size:.95rem;font-weight:600;margin-bottom:4px}
.tl-item .desc{font-size:.82rem;color:var(--text2)}
.tl-checks{list-style:none;padding:0;margin-top:8px}
.tl-checks li{font-size:.82rem;color:var(--text2);padding:3px 0;padding-left:20px;position:relative}
.tl-checks li::before{content:'‚òê';position:absolute;left:0;color:var(--text3)}

/* ===== Code Preview ===== */
.code-wrap{background:#0d1117;border:1px solid var(--border);border-radius:var(--r);overflow:hidden;margin-bottom:16px}
.code-bar{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);padding:8px 16px;border-bottom:1px solid var(--border)}
.code-bar .filename{font-size:.78rem;color:var(--text2);font-family:'JetBrains Mono',monospace}
.code-bar .lang{font-size:.7rem;color:var(--text3);background:var(--bg3);padding:2px 8px;border-radius:4px}
pre.code{padding:16px;overflow-x:auto;font-size:.8rem;line-height:1.7;color:#c9d1d9;font-family:'JetBrains Mono',monospace;margin:0}
pre.code .kw{color:#ff7b72}
pre.code .fn{color:#d2a8ff}
pre.code .str{color:#a5d6ff}
pre.code .cm{color:#8b949e;font-style:italic}
pre.code .ty{color:#79c0ff}
pre.code .num{color:#ffa657}
pre.code .at{color:#ffa657}

/* ===== Dying Chains ===== */
.dying-table{width:100%;border-collapse:collapse}
.dying-table th{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--text3);text-align:left;padding:8px 12px;border-bottom:1px solid var(--border)}
.dying-table td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:.88rem}
.dying-table tr:last-child td{border-bottom:none}
.dying-table .chain-name{font-weight:600}
.bar-bg{width:100px;height:6px;background:var(--bg3);border-radius:3px;overflow:hidden}
.bar-fill{height:100%;border-radius:3px}

/* ===== Loading ===== */
.loader{display:none;text-align:center;padding:48px 0}
.loader.on{display:block}
.spin{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:sp .8s linear infinite;margin:0 auto 16px}
@keyframes sp{to{transform:rotate(360deg)}}
.load-text{color:var(--text2);font-size:.9rem}
.load-step{color:var(--cyan);font-size:.82rem;margin-top:6px;opacity:.8}

/* ===== Recommendation Banner ===== */
.rec-banner{background:linear-gradient(135deg,rgba(6,214,160,.06),rgba(123,97,255,.06));border:1px solid rgba(6,214,160,.15);border-radius:var(--r-lg);padding:28px;margin-bottom:24px;text-align:center}
.rec-grade{font-size:4rem;font-weight:900;line-height:1}
.gA{color:var(--green)}.gB{color:var(--cyan)}.gC{color:var(--amber)}.gD{color:var(--red)}.gF{color:var(--red)}
.rec-text{color:var(--text2);max-width:560px;margin:8px auto 0;font-size:.92rem}
.rec-sunrise{color:var(--cyan);margin-top:10px;font-size:.88rem}

/* ===== Footer ===== */
footer{text-align:center;padding:40px 24px;color:var(--text3);font-size:.82rem;border-top:1px solid var(--border);margin-top:48px}
footer a{color:var(--text2)}
footer .row{display:flex;justify-content:center;gap:24px;margin-top:8px;flex-wrap:wrap}

/* ===== Responsive ===== */
@media(max-width:768px){
  .form-grid{grid-template-columns:1fr}
  .arrow-sep{transform:rotate(90deg);padding:0}
  .compare{grid-template-columns:1fr}
  .vs{transform:rotate(90deg);padding:8px 0}
  .scores{grid-template-columns:repeat(2,1fr)}
  .hero-stats{gap:20px}
  .nav-tab{padding:10px 14px;font-size:.82rem}
}
@media(max-width:480px){
  .scores{grid-template-columns:1fr 1fr}
  .pat-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="bg-mesh"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>
<div class="bg-grid"></div>

<div class="wrap">
<!-- ============ HERO ============ -->
<section class="hero">
  <div class="container">
    <div class="hero-badge">üß† AI-Powered ¬∑ Real-Time Data ¬∑ Zero Dependencies</div>
    <h1><span class="grad">MigrateAI</span></h1>
    <p class="sub">Cross-chain migration feasibility analysis powered by live DeFi data. Know before you move ‚Äî chain health, bridge risk, contract complexity, and a full migration playbook.</p>
    <div class="hero-stats" id="heroStats">
      <div class="hero-stat"><div class="num" id="hChains">‚Äî</div><div class="lbl">Chains Tracked</div></div>
      <div class="hero-stat"><div class="num" id="hBridges">5</div><div class="lbl">Bridge Protocols</div></div>
      <div class="hero-stat"><div class="num" id="hPatterns">10</div><div class="lbl">Contract Patterns</div></div>
      <div class="hero-stat"><div class="num" id="hVol">‚Äî</div><div class="lbl">24h Bridge Volume</div></div>
    </div>
  </div>
</section>

<!-- ============ TABS ============ -->
<div class="container">
  <div class="nav-tabs" id="navTabs">
    <div class="nav-tab active" data-tab="analyze">üî¨ Analyze</div>
    <div class="nav-tab" data-tab="scanner">üì° Chain Scanner</div>
    <div class="nav-tab" data-tab="codegen">‚ö° Code Generator</div>
    <div class="nav-tab" data-tab="about">‚ÑπÔ∏è About</div>
  </div>

  <!-- ========== TAB: ANALYZE ========== -->
  <div class="tab-panel active" id="tab-analyze">
    <div class="card">
      <h2>üî¨ Migration Analysis</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>Source Chain (FROM)</label>
          <select class="form-select" id="srcChain"><option value="">Select chain...</option></select>
        </div>
        <div class="arrow-sep">‚Üí</div>
        <div class="form-group">
          <label>Target Chain (TO)</label>
          <select class="form-select" id="tgtChain"><option value="">Select chain...</option></select>
        </div>
      </div>
      <div class="form-group" style="margin-bottom:16px">
        <label>Project Name (optional)</label>
        <input class="form-input" id="projName" placeholder="e.g., SpookySwap, MyDeFi Protocol">
      </div>
      <div class="form-group" style="margin-bottom:20px">
        <label>Contract Types (click to select)</label>
        <div class="tags" id="cTags"></div>
      </div>
      <button class="btn btn-primary" id="goBtn" onclick="analyze()">üîç Analyze Migration Feasibility</button>
    </div>

    <div class="loader" id="loader">
      <div class="spin"></div>
      <div class="load-text">Analyzing migration feasibility‚Ä¶</div>
      <div class="load-step" id="loadStep">Fetching chain health from DeFi Llama‚Ä¶</div>
    </div>

    <div id="results"></div>
  </div>

  <!-- ========== TAB: SCANNER ========== -->
  <div class="tab-panel" id="tab-scanner">
    <div class="card">
      <h2>üì° Dying Chains Scanner</h2>
      <p style="color:var(--text2);margin-bottom:16px">Scans all chains on DeFi Llama for declining TVL ‚Äî potential migration candidates. Chains with &gt;$1M TVL and a 30-day decline.</p>
      <button class="btn btn-primary" onclick="scanDying()" id="scanBtn">üîç Scan for Declining Chains</button>
    </div>
    <div class="loader" id="scanLoader">
      <div class="spin"></div>
      <div class="load-text">Scanning chain health data‚Ä¶</div>
      <div class="load-step">Fetching TVL history for all chains from DeFi Llama‚Ä¶</div>
    </div>
    <div id="scanResults"></div>
  </div>

  <!-- ========== TAB: CODE GEN ========== -->
  <div class="tab-panel" id="tab-codegen">
    <div class="card">
      <h2>‚ö° Anchor Project Generator</h2>
      <p style="color:var(--text2);margin-bottom:16px">Generate a complete Solana Anchor project scaffold from EVM contract patterns. Includes state accounts, instructions, tests, Wormhole NTT config, and a migration guide.</p>
      <div class="form-group" style="margin-bottom:16px">
        <label>Project Name</label>
        <input class="form-input" id="cgName" placeholder="e.g., my_defi_protocol" value="my_project">
      </div>
      <div class="form-group" style="margin-bottom:16px">
        <label>Source Chain</label>
        <input class="form-input" id="cgSource" placeholder="e.g., Ethereum" value="Ethereum">
      </div>
      <div class="form-group" style="margin-bottom:20px">
        <label>Contract Types (click to select)</label>
        <div class="tags" id="cgTags"></div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <button class="btn btn-primary" style="flex:1;min-width:200px" onclick="generateCode()">‚ö° Generate Anchor Project</button>
        <button class="btn btn-ghost" style="min-width:160px" onclick="downloadCode()" id="dlBtn" disabled>üì• Download ZIP</button>
      </div>
    </div>
    <div id="codeResults"></div>
  </div>

  <!-- ========== TAB: ABOUT ========== -->
  <div class="tab-panel" id="tab-about">
    <div class="card">
      <h2>‚ÑπÔ∏è About MigrateAI</h2>
      <p style="margin-bottom:16px">MigrateAI is an <strong>AI-powered cross-chain migration feasibility analyzer</strong>. It combines real-time blockchain data with deep knowledge of smart contract patterns to help teams make informed migration decisions.</p>
      <h3>What It Does</h3>
      <ul style="color:var(--text2);padding-left:20px;margin-bottom:20px">
        <li><strong>Chain Health Comparison</strong> ‚Äî Live TVL, protocol count, and trend analysis via DeFi Llama</li>
        <li><strong>Bridge Route Discovery</strong> ‚Äî Finds available bridges (Wormhole, LayerZero, CCTP, Axelar, deBridge) with risk scoring</li>
        <li><strong>Risk Assessment</strong> ‚Äî Composite score from chain health, bridge risk, code complexity, and historical exploits</li>
        <li><strong>Contract Pattern Analysis</strong> ‚Äî 10 EVM‚ÜíSolana pattern mappings with difficulty ratings and key differences</li>
        <li><strong>Code Generation</strong> ‚Äî Full Anchor project scaffold from EVM contract patterns (17 files)</li>
        <li><strong>Migration Playbook</strong> ‚Äî 4-phase actionable plan with checklists</li>
        <li><strong>Dying Chain Scanner</strong> ‚Äî Identifies chains with declining TVL as migration candidates</li>
      </ul>
      <h3>Data Sources</h3>
      <ul style="color:var(--text2);padding-left:20px;margin-bottom:20px">
        <li><a href="https://defillama.com" target="_blank">DeFi Llama</a> ‚Äî Chain TVL, protocols, bridges (400+ chains, 7000+ protocols)</li>
        <li><a href="https://wormholescan.io" target="_blank">WormholeScan</a> ‚Äî Cross-chain bridge data ($74B+ total volume)</li>
      </ul>
      <h3>Tech Stack</h3>
      <p style="color:var(--text2);margin-bottom:20px">Pure Python backend (zero dependencies ‚Äî stdlib only: urllib + json). Single HTML frontend with vanilla JS. No frameworks, no build step, no API keys needed.</p>
      <h3>Built For</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px">
        <span class="tag on">ü™¶ Solana Graveyard Hack ‚Äî Sunrise Track</span>
        <span class="tag on">üîó Chainlink Convergence ‚Äî CRE Track</span>
        <span class="tag on">‚ö´ Polkadot Solidity Hackathon</span>
      </div>
      <p style="color:var(--text3);font-size:.85rem">Created by <a href="https://x.com/jeanclawbotdamn">@jeanclawbotdamn</a> ü¶Ä ‚Äî an autonomous AI agent built on <a href="https://openclaw.ai">OpenClaw</a>.</p>
    </div>
  </div>
</div>

<footer>
  <p><strong>MigrateAI v0.1</strong> ‚Äî AI-Powered Cross-Chain Migration Analyzer</p>
  <div class="row">
    <a href="https://github.com/jeanclawdbotdamn/migrateai" target="_blank">GitHub</a>
    <a href="https://x.com/jeanclawbotdamn" target="_blank">Twitter</a>
    <a href="https://defillama.com" target="_blank">DeFi Llama</a>
    <a href="https://wormholescan.io" target="_blank">WormholeScan</a>
    <a href="https://openclaw.ai" target="_blank">OpenClaw</a>
  </div>
  <p style="margin-top:8px">Zero dependencies ¬∑ Pure Python + vanilla JS ¬∑ Free & open source</p>
</footer>
</div>

<script>
// =============================================================================
// DATA
// =============================================================================
const CHAINS=["Ethereum","Solana","BSC","Polygon","Arbitrum","Optimism","Avalanche","Fantom","Base","Sui","Aptos","Near","Cosmos","Polkadot","Tron","TON","zkSync Era","Scroll","Linea","Mantle","Manta","Blast","Starknet","Celo","Moonbeam","Harmony","Cronos","Cardano","Sei","Injective"];
const C_TYPES=["ERC-20","ERC-721","AMM/DEX","Lending/Borrowing","Staking","Governance/DAO","Vault/Yield","Bridge","Oracle Consumer","Multisig"];
const EVM=new Set(["ethereum","bsc","polygon","arbitrum","optimism","base","avalanche","fantom","zksync era","scroll","linea","mantle","manta","blast","cronos","celo","moonbeam","harmony","sei"]);

const BRIDGES={
  "Wormhole":{type:"message-passing",chains:["solana","ethereum","bsc","polygon","arbitrum","optimism","avalanche","base","sui","fantom","aptos","near","injective","sei"],ntt:true,sunrise:true,risk:25},
  "LayerZero":{type:"message-passing",chains:["ethereum","bsc","polygon","arbitrum","optimism","avalanche","base","fantom","solana"],risk:20},
  "CCTP (Circle)":{type:"burn-and-mint",chains:["ethereum","arbitrum","optimism","base","polygon","solana","avalanche"],risk:10,note:"USDC only"},
  "Axelar":{type:"message-passing",chains:["ethereum","polygon","avalanche","fantom","arbitrum","optimism","base","cosmos","sei"],risk:30},
  "deBridge":{type:"lock-and-mint",chains:["ethereum","bsc","polygon","arbitrum","solana","avalanche","base"],risk:35},
};

const PATTERNS={
  "ERC-20":{to:"SPL Token / Token-2022",d:2,n:"Direct mapping. Token-2022 adds transfer fees, confidential transfers.",diffs:["ERC-20 is per-contract; SPL Token is one program for ALL tokens","Balances in Associated Token Accounts, not contract storage","Mint authority replaces owner/admin pattern","No approve/transferFrom ‚Äî use delegate"]},
  "ERC-721":{to:"Metaplex Token Standard",d:3,n:"NFT = SPL token with supply of 1 and 0 decimals.",diffs:["Metadata in separate Metaplex account","Collection verification via Certified Collections","Royalty enforcement via Programmable NFTs"]},
  "AMM/DEX":{to:"Raydium CLMM / Orca Whirlpool",d:8,n:"Major architectural differences. Account-based pool state.",diffs:["Pool state in PDAs, not contract storage","Token reserves in SPL accounts owned by pool PDA","CPI to SPL Token for transfers","No reentrancy (single-threaded per tx)","Compute unit limits replace gas optimization"]},
  "Lending/Borrowing":{to:"Solend / MarginFi / Kamino",d:9,n:"Complex state management. Interest rate models need reimplementation.",diffs:["User positions in separate accounts","Pyth/Switchboard instead of Chainlink","Flash loans via CPI (different pattern)"]},
  "Staking":{to:"SPL Stake Pool / Anchor staking",d:4,n:"Relatively straightforward. Native staking infrastructure.",diffs:["Stake accounts are first-class objects","No block.timestamp ‚Äî use Clock sysvar","Reward distribution via separate claim ix"]},
  "Governance/DAO":{to:"Realms (SPL Governance) / Squads",d:5,n:"Realms is the standard Solana governance framework.",diffs:["Proposals, votes as separate accounts","Token-weighted voting via plugins","Squads v4 for multisig treasury"]},
  "Vault/Yield":{to:"Kamino / Custom Anchor vault",d:6,n:"No ERC-4626 standard on Solana.",diffs:["Vault shares as SPL tokens","Strategy via CPI to DEX/lending","Rebalancing via off-chain cranks"]},
  "Bridge":{to:"Wormhole NTT / Custom program",d:9,n:"Use Wormhole NTT SDK for standard bridge needs.",diffs:["Guardian network for verification","NTT Manager handles burn-mint flow","VAA instead of merkle proofs","Rate limiting built into NTT"]},
  "Oracle Consumer":{to:"Pyth / Switchboard",d:2,n:"Drop-in Chainlink replacement.",diffs:["Pyth accounts passed as instruction args","Pull oracle ‚Äî prices updated on-demand","Confidence intervals included"]},
  "Multisig":{to:"Squads v4",d:2,n:"Well-audited, widely used.",diffs:["Vault PDA holds assets","Transaction proposals as accounts","Built-in spending limits and timelocks"]},
};

const DEXES={
  solana:["Jupiter","Raydium","Orca","Meteora","Phoenix","Lifinity"],
  ethereum:["Uniswap","Curve","Balancer","SushiSwap","1inch"],
  bsc:["PancakeSwap","Venus","Biswap","Thena"],
  polygon:["QuickSwap","Uniswap","Balancer","Curve"],
  arbitrum:["GMX","Camelot","Uniswap","Trader Joe"],
  optimism:["Velodrome","Uniswap","Synthetix"],
  avalanche:["Trader Joe","Pangolin","Curve"],
  fantom:["SpookySwap","Beethoven X","Equalizer"],
  base:["Aerodrome","Uniswap","BaseSwap","Maverick"],
  sui:["Cetus","Turbos","KriyaDEX"],
};

const STABLES={
  solana:["USDC (native)","USDT","pyUSD"],
  ethereum:["USDC","USDT","DAI","GHO"],
  bsc:["USDT","USDC","DAI"],
  polygon:["USDC (native)","USDT","DAI"],
  arbitrum:["USDC (native)","USDT","DAI"],
  optimism:["USDC (native)","USDT","sUSD"],
  avalanche:["USDC","USDT","DAI"],
  fantom:["USDC (bridged)","USDT (bridged)"],
  base:["USDC (native)","USDbC","DAI"],
};

const EXPLOITS=[
  {bridge:"Wormhole",date:"2022-02",loss:320,recovered:true,note:"VAA signature bypass. Patched, Jump Crypto covered."},
  {bridge:"Ronin",date:"2022-03",loss:625,recovered:false,note:"Social engineering of validators."},
  {bridge:"Nomad",date:"2022-08",loss:190,recovered:false,note:"Init bug allowed anyone to drain."},
  {bridge:"Harmony",date:"2022-06",loss:100,recovered:false,note:"Compromised private keys."},
  {bridge:"Multichain",date:"2023-07",loss:126,recovered:false,note:"CEO arrested, MPC keys compromised."},
];

// =============================================================================
// STATE
// =============================================================================
let selContracts=new Set(), cgContracts=new Set(), allChainData=[], generatedFiles=null;

// =============================================================================
// INIT
// =============================================================================
function init(){
  // Populate selects
  ['srcChain','tgtChain'].forEach(id=>{
    const el=$(id);
    CHAINS.forEach(c=>el.innerHTML+=`<option value="${c.toLowerCase()}">${c}</option>`);
  });
  $(srcChain).value='fantom'; $(tgtChain).value='solana';

  // Tags for analyze
  mkTags('cTags',selContracts);
  // Tags for codegen
  mkTags('cgTags',cgContracts);

  // Tab switching
  document.querySelectorAll('.nav-tab').forEach(t=>{
    t.onclick=()=>{
      document.querySelectorAll('.nav-tab').forEach(x=>x.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      $('tab-'+t.dataset.tab).classList.add('active');
    };
  });

  // Prefetch
  fetchHeroData();
}

function mkTags(containerId,set){
  const el=$(containerId);
  C_TYPES.forEach(ct=>{
    const tag=document.createElement('div');
    tag.className='tag';tag.textContent=ct;
    tag.onclick=()=>{
      tag.classList.toggle('on');
      set.has(ct)?set.delete(ct):set.add(ct);
    };
    el.appendChild(tag);
  });
}

function $(id){return document.getElementById(id)}
function fmt(n){return n>=1e12?`$${(n/1e12).toFixed(1)}T`:n>=1e9?`$${(n/1e9).toFixed(2)}B`:n>=1e6?`$${(n/1e6).toFixed(1)}M`:n>=1e3?`$${(n/1e3).toFixed(0)}K`:`$${Math.round(n)}`}

async function fetchHeroData(){
  try{
    const [cr,wr]=await Promise.allSettled([
      fetch('https://api.llama.fi/v2/chains').then(r=>r.json()),
      fetch('https://api.wormholescan.io/api/v1/scorecards').then(r=>r.json()),
    ]);
    if(cr.status==='fulfilled'){allChainData=cr.value;$('hChains').textContent=cr.value.length}
    if(wr.status==='fulfilled'&&wr.value['24h_volume'])$('hVol').textContent=fmt(parseFloat(wr.value['24h_volume']));
  }catch(e){console.log('Prefetch error',e)}
}

// =============================================================================
// ANALYZE
// =============================================================================
async function analyze(){
  const src=$(srcChain).value, tgt=$(tgtChain).value, proj=$(projName).value||'Your Project';
  if(!src||!tgt)return alert('Select both chains');
  if(src===tgt)return alert('Source and target must differ');

  const btn=$(goBtn); btn.disabled=true; btn.textContent='‚è≥ Analyzing‚Ä¶';
  $('loader').classList.add('on'); $('results').innerHTML='';

  const steps=['Fetching chain health from DeFi Llama‚Ä¶','Querying WormholeScan bridge data‚Ä¶','Analyzing bridge routes & risks‚Ä¶','Evaluating contract migration complexity‚Ä¶','Scoring overall feasibility‚Ä¶','Generating migration playbook‚Ä¶'];
  let si=0;
  const iv=setInterval(()=>{si=Math.min(si+1,steps.length-1);$('loadStep').textContent=steps[si]},900);

  try{
    const [chainsR,whR]=await Promise.allSettled([
      allChainData.length?Promise.resolve(allChainData):fetch('https://api.llama.fi/v2/chains').then(r=>r.json()),
      fetch('https://api.wormholescan.io/api/v1/scorecards').then(r=>r.json()),
    ]);
    const chains=chainsR.status==='fulfilled'?chainsR.value:[];
    const wh=whR.status==='fulfilled'?whR.value:{};

    const srcC=findC(chains,src), tgtC=findC(chains,tgt);

    const [shR,thR]=await Promise.allSettled([
      fetch(`https://api.llama.fi/v2/historicalChainTvl/${encodeURIComponent(srcC?.name||src)}`).then(r=>r.json()),
      fetch(`https://api.llama.fi/v2/historicalChainTvl/${encodeURIComponent(tgtC?.name||tgt)}`).then(r=>r.json()),
    ]);
    const srcT=trend(shR.status==='fulfilled'?shR.value:[]);
    const tgtT=trend(thR.status==='fulfilled'?thR.value:[]);

    const bridges=getBridges(src,tgt);
    const feas=feasibility(srcC,tgtC,srcT,tgtT,src,tgt,bridges);
    const risk=riskScore(srcC,tgtC,srcT,tgtT,src,tgt,bridges);
    const ctrx=selContracts.size?contractAnalysis(Array.from(selContracts),src,tgt):null;

    clearInterval(iv);
    $('loader').classList.remove('on');
    renderResults({src,tgt,proj,srcC,tgtC,srcT,tgtT,bridges,feas,risk,ctrx,wh});
  }catch(e){
    clearInterval(iv);$('loader').classList.remove('on');
    $('results').innerHTML=`<div class="card" style="border-color:var(--red)"><h2>‚ùå Analysis Error</h2><p style="color:var(--text2)">${e.message}</p><p style="color:var(--text3);margin-top:8px">DeFi Llama or WormholeScan may be temporarily unavailable. Try again in a moment.</p></div>`;
  }
  btn.disabled=false;btn.textContent='üîç Analyze Migration Feasibility';
}

function findC(chains,name){const n=name.toLowerCase();return chains.find(c=>c.name.toLowerCase()===n)||chains.find(c=>(c.tokenSymbol||'').toLowerCase()===n)||{name:name,tvl:0}}
function trend(h){if(!Array.isArray(h)||h.length<30)return{c:0,t:'unknown'};const now=h[h.length-1]?.tvl||0,ago=h[Math.max(0,h.length-31)]?.tvl||1;const c=((now-ago)/ago)*100;return{c,t:c>5?'growing':c<-5?'declining':'stable'}}

function getBridges(s,t){
  s=s.toLowerCase();t=t.toLowerCase();
  return Object.entries(BRIDGES).filter(([_,b])=>b.chains.includes(s)&&b.chains.includes(t)).map(([n,b])=>({name:n,...b})).sort((a,b)=>a.risk-b.risk);
}

function feasibility(srcC,tgtC,srcT,tgtT,sn,tn,bridges){
  let s=50;
  if((tgtC?.tvl||0)>1e9)s+=15;else if((tgtC?.tvl||0)>100e6)s+=10;
  if(srcT.t==='declining')s+=12;
  if(tgtT.t==='growing')s+=12;else if(tgtT.t==='declining')s-=8;
  if(bridges.length>=3)s+=8;else if(bridges.length===0)s-=20;
  const crossVM=EVM.has(sn)!==EVM.has(tn);
  if(crossVM)s-=10;
  if(bridges.some(b=>b.sunrise)&&tn==='solana')s+=5;
  s=Math.max(0,Math.min(100,s));
  const g=s>=80?'A':s>=65?'B':s>=45?'C':s>=30?'D':'F';
  return{s,g};
}

function riskScore(srcC,tgtC,srcT,tgtT,sn,tn,bridges){
  let s=20;const ch=[];
  const srcEvm=EVM.has(sn),tgtSol=tn==='solana';
  if(srcEvm&&tgtSol){s+=25;ch.push({sev:'HIGH',title:'Cross-VM Migration (EVM ‚Üí SVM)',d:'Full contract rewrite: Solidity ‚Üí Rust/Anchor. Different execution model, account-based storage.'})}
  else if(srcEvm&&!EVM.has(tn)){s+=20;ch.push({sev:'HIGH',title:'Cross-VM Migration',d:'Different virtual machines require significant code changes.'})}
  if(!bridges.length){s+=25;ch.push({sev:'HIGH',title:'No Standard Bridge',d:'No major bridge supports this chain pair. Custom bridge or intermediary required.'})}
  else if(bridges[0].risk>30){s+=10;ch.push({sev:'MEDIUM',title:'Elevated Bridge Risk',d:`Best bridge (${bridges[0].name}) has higher risk score.`})}
  if(srcT.c<-20){s+=5;ch.push({sev:'MEDIUM',title:'Rapid Source Decline',d:`Source TVL dropped ${srcT.c.toFixed(1)}% in 30d. Urgency increases error risk.`})}
  if((tgtC?.tvl||0)<10e6){s+=15;ch.push({sev:'HIGH',title:'Low Target Liquidity',d:'Target chain TVL < $10M. Liquidity bootstrapping will be difficult.'})}
  if(selContracts.size){
    const mx=Math.max(...Array.from(selContracts).map(c=>(PATTERNS[c]?.d||5)));
    if(mx>=8){s+=15;ch.push({sev:'HIGH',title:'Complex Contracts',d:'Includes highly complex patterns (8+/10) requiring expert migration.'})}
    else if(mx>=5){s+=5;ch.push({sev:'MEDIUM',title:'Moderate Complexity',d:'Some patterns require significant redesign.'})}
  }
  if(srcEvm&&tgtSol){
    ch.push({sev:'HIGH',title:'Account Model Redesign',d:'EVM storage slots ‚Üí Solana accounts (PDAs). All state management must be redesigned.'});
    ch.push({sev:'MEDIUM',title:'Token Standard Change',d:'ERC-20 ‚Üí SPL Token/Token-2022. Different interfaces, approval patterns.'});
    ch.push({sev:'LOW',title:'No Reentrancy Risk',d:"Solana is single-threaded per transaction. Remove reentrancy guards, simplify logic."});
  }
  s=Math.min(100,s);
  const lv=s<30?'LOW':s<50?'MODERATE':s<70?'HIGH':'CRITICAL';
  return{s,lv,ch};
}

function contractAnalysis(types){
  const pats=types.map(t=>({type:t,...(PATTERNS[t]||{to:'Custom Anchor',d:7,n:'Custom implementation required.',diffs:['Full reimplementation']})}));
  const mx=Math.max(...pats.map(p=>p.d)),avg=pats.reduce((s,p)=>s+p.d,0)/pats.length;
  const ov=Math.round(avg*.3+mx*.7);
  const wk=ov<=3?'2-4':ov<=6?'4-8':ov<=8?'8-16':'16-24+';
  return{pats,ov,mx,wk,bn:pats.reduce((a,b)=>a.d>b.d?a:b).type};
}

function gaugeHtml(val,max,color){
  const r=42,c=2*Math.PI*r,pct=Math.min(val/max,1);
  return`<div class="gauge"><svg width="100" height="100" viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="${r}"/><circle class="fill" cx="50" cy="50" r="${r}" stroke="${color}" stroke-dasharray="${c}" stroke-dashoffset="${c*(1-pct)}"/></svg><div class="center" style="color:${color}">${val}</div></div>`;
}
function tc(t){return t==='growing'?'up':t==='declining'?'down':'flat'}
function ti(t){return t==='growing'?'üìà':t==='declining'?'üìâ':'‚û°Ô∏è'}

function renderResults(d){
  const{src,tgt,proj,srcC,tgtC,srcT,tgtT,bridges,feas,risk,ctrx,wh}=d;
  const fc=feas.s>=65?'var(--green)':feas.s>=45?'var(--amber)':'var(--red)';
  const rc=risk.s<40?'var(--green)':risk.s<60?'var(--amber)':'var(--red)';
  const sN=srcC?.name||src,tN=tgtC?.name||tgt;
  const hasSunrise=bridges.some(b=>b.sunrise)&&tgt==='solana';

  let h=`
  <div class="scores">
    <div class="score-box"><div class="lbl">Feasibility</div>${gaugeHtml(feas.s,100,fc)}<div class="sub">Grade ${feas.g}</div></div>
    <div class="score-box"><div class="lbl">Risk Level</div>${gaugeHtml(risk.s,100,rc)}<div class="sub">${risk.lv}</div></div>
    <div class="score-box"><div class="lbl">Bridge Routes</div><div class="val" style="color:${bridges.length?'var(--green)':'var(--red)'}; padding-top:18px">${bridges.length}</div><div class="sub">available</div></div>
    <div class="score-box"><div class="lbl">Wormhole 24h Vol</div><div class="val" style="color:var(--blue);font-size:1.3rem;padding-top:22px">${wh['24h_volume']?fmt(parseFloat(wh['24h_volume'])):'N/A'}</div><div class="sub">network volume</div></div>
  </div>

  <div class="rec-banner">
    <div style="font-size:.8rem;color:var(--text3);text-transform:uppercase;letter-spacing:.05em;margin-bottom:4px">Migration Feasibility: ${proj}</div>
    <div class="rec-grade g${feas.g}">${feas.g}</div>
    <div class="rec-text">${feas.s>=65?'Strong migration case. Target chain offers significant advantages.':feas.s>=45?'Moderate migration case. Benefits exist but weigh costs carefully.':'Weak migration case. Challenges may outweigh benefits.'}</div>
    ${hasSunrise?'<div class="rec-sunrise">‚ú® <strong>Wormhole Sunrise available</strong> ‚Äî canonical asset onboarding to Solana with day-one liquidity via NTT.</div>':''}
  </div>

  <div class="compare">
    <div class="chain-box">
      <h4>üì§ ${sN}</h4>
      <div class="chain-row"><span class="k">TVL</span><span class="v">${fmt(srcC?.tvl||0)}</span></div>
      <div class="chain-row"><span class="k">30d Change</span><span class="v ${tc(srcT.t)}">${srcT.c.toFixed(1)}% ${ti(srcT.t)}</span></div>
      <div class="chain-row"><span class="k">DEXes</span><span class="v">${(DEXES[src]||['‚Äî']).slice(0,3).join(', ')}</span></div>
      <div class="chain-row"><span class="k">Stablecoins</span><span class="v">${(STABLES[src]||['‚Äî']).slice(0,2).join(', ')}</span></div>
    </div>
    <div class="vs">‚Üí</div>
    <div class="chain-box">
      <h4>üì• ${tN}</h4>
      <div class="chain-row"><span class="k">TVL</span><span class="v">${fmt(tgtC?.tvl||0)}</span></div>
      <div class="chain-row"><span class="k">30d Change</span><span class="v ${tc(tgtT.t)}">${tgtT.c.toFixed(1)}% ${ti(tgtT.t)}</span></div>
      <div class="chain-row"><span class="k">DEXes</span><span class="v">${(DEXES[tgt]||['‚Äî']).slice(0,3).join(', ')}</span></div>
      <div class="chain-row"><span class="k">Stablecoins</span><span class="v">${(STABLES[tgt]||['‚Äî']).slice(0,2).join(', ')}</span></div>
    </div>
  </div>

  <div class="card">
    <h3>üåâ Bridge Routes (${bridges.length})</h3>
    ${!bridges.length?'<p style="color:var(--red)">‚ö†Ô∏è No standard bridges support this chain pair. Custom bridge or intermediary chain required.</p>':
    bridges.map(b=>`<div class="bridge-row"><span><span class="name">${b.name}</span>${b.ntt?' üåÖ':''}<span class="type">${b.type}</span>${b.note?` <span style="color:var(--text3);font-size:.75rem">(${b.note})</span>`:''}</span><span class="risk ${b.risk<20?'rk-lo':b.risk<35?'rk-md':'rk-hi'}">${b.risk<20?'Low':b.risk<35?'Medium':'High'} Risk</span></div>`).join('')}
    ${hasSunrise?'<p style="margin-top:12px;color:var(--cyan);font-size:.88rem">‚ú® Wormhole Sunrise: Canonical route for external assets entering Solana. Provides day-one liquidity via NTT (Native Token Transfer). <a href="https://wormhole.com/docs/products/token-transfers/native-token-transfers/" target="_blank">Docs ‚Üí</a></p>':''}
  </div>`;

  // Risk challenges
  if(risk.ch.length){
    h+=`<div class="card"><h3>‚ö†Ô∏è Key Challenges (${risk.ch.length})</h3>
    ${risk.ch.map(c=>`<div class="ch-item ch-${c.sev}"><div class="title">${c.sev==='HIGH'?'üî¥':c.sev==='MEDIUM'?'üü°':'üü¢'} ${c.title}</div><div class="detail">${c.d}</div></div>`).join('')}
    </div>`;
  }

  // Contract analysis
  if(ctrx){
    h+=`<div class="card"><h3>üìù Contract Migration (${ctrx.ov}/10 difficulty ¬∑ ~${ctrx.wk} weeks)</h3>
    <p style="color:var(--text2);margin-bottom:14px">Bottleneck: <strong>${ctrx.bn}</strong> (${ctrx.mx}/10)</p>
    <div class="pat-grid">
    ${ctrx.pats.map(p=>`<div class="pat-card">
      <div class="pat-hdr"><span class="pat-name">${p.type}</span><span class="pat-diff ${p.d<=3?'d-easy':p.d<=6?'d-med':'d-hard'}">${p.d}/10</span></div>
      <div class="pat-arrow">‚Üí ${p.to}</div>
      <div class="pat-notes">${p.n}</div>
      ${p.diffs?`<ul style="margin-top:8px;padding-left:16px;font-size:.78rem;color:var(--text3)">${p.diffs.slice(0,3).map(d=>`<li>${d}</li>`).join('')}</ul>`:''}
    </div>`).join('')}
    </div></div>`;
  }

  // Liquidity plan
  const liqSteps=tgt==='solana'?['Deploy SPL token (or Token-2022 for extensions)','Seed liquidity on Jupiter via Meteora or Orca CLMM','Apply for Jupiter Verified Token List','Set up Raydium CPMM pool','Register on Solana token registry']:
    EVM.has(tgt)?[`Deploy ERC-20 on ${tN}`,'Create Uniswap V3 pool','Seed initial liquidity ($10K+)','Register on token lists']:
    [`Deploy token on ${tN}`,'Create pool on primary DEX','Seed initial liquidity'];
  h+=`<div class="card"><h3>üíß Liquidity Bootstrapping Plan</h3><div class="steps">${liqSteps.map(s=>`<div class="step">${s}</div>`).join('')}</div></div>`;

  // Playbook
  const srcEvm=EVM.has(src),tgtSol=tgt==='solana';
  const estWeeks=ctrx?ctrx.wk:(srcEvm&&tgtSol?'8-16':'4-8');
  h+=`<div class="card"><h3>üìã Migration Playbook</h3>
  <div class="timeline">
    <div class="tl-item"><div class="tl-dot">1</div><h4>Phase 1: Assessment & Planning (Week 1-2)</h4><div class="desc">Audit contracts, research target chain, plan bridge strategy.</div>
      <ul class="tl-checks"><li>Document all deployed contracts on source chain</li><li>Map contract interactions and dependencies</li><li>Identify oracle & external integrations</li><li>Study target chain's account/execution model</li><li>Confirm bridge support (Wormhole NTT, CCTP, etc.)</li></ul>
    </div>
    <div class="tl-item"><div class="tl-dot">2</div><h4>Phase 2: Development (Week 2-${estWeeks.split('-')[1]||'8'})</h4><div class="desc">${srcEvm&&tgtSol?'Rewrite contracts in Rust/Anchor. Redesign account model.':'Migrate contracts to target chain. Adjust chain-specific patterns.'}</div>
      <ul class="tl-checks">${srcEvm&&tgtSol?'<li>Redesign data model for PDAs</li><li>Implement core program in Anchor/Rust</li><li>Replace EVM events ‚Üí Anchor events</li><li>Implement CPI for composability</li><li>Unit tests + devnet deployment</li><li>Security audit (OtterSec, Sec3)</li>':'<li>Deploy contracts to testnet</li><li>Adjust gas/compute parameters</li><li>Update oracle integrations</li><li>Full test suite</li>'}</ul>
    </div>
    <div class="tl-item"><div class="tl-dot">3</div><h4>Phase 3: Token & Liquidity Migration</h4><div class="desc">Bridge setup, liquidity seeding, user migration.</div>
      <ul class="tl-checks"><li>Deploy Wormhole NTT Manager (if applicable)</li><li>Configure burn-and-mint or lock-and-mint</li><li>Seed liquidity on target DEX</li><li>Set up migration incentives</li><li>Community announcement (>2 weeks notice)</li></ul>
    </div>
    <div class="tl-item"><div class="tl-dot">4</div><h4>Phase 4: Launch & Post-Migration</h4><div class="desc">Mainnet deployment, monitoring, source chain sunset.</div>
      <ul class="tl-checks"><li>Deploy to mainnet + verify source</li><li>Enable bridge transfers</li><li>Monitor flows & token supply integrity</li><li>Deprecate source chain contracts</li><li>Final state snapshot</li></ul>
    </div>
  </div></div>`;

  // Historical bridge exploits
  h+=`<div class="card"><h3>üõ°Ô∏è Historical Bridge Incidents</h3>
  <p style="color:var(--text2);margin-bottom:12px;font-size:.85rem">Major bridge exploits tracked for risk context.</p>
  <table class="dying-table"><thead><tr><th>Bridge</th><th>Date</th><th>Loss</th><th>Recovered</th><th>Note</th></tr></thead><tbody>
  ${EXPLOITS.map(e=>`<tr><td class="chain-name">${e.bridge}</td><td>${e.date}</td><td style="color:var(--red)">$${e.loss}M</td><td>${e.recovered?'<span style="color:var(--green)">‚úÖ Yes</span>':'<span style="color:var(--red)">‚ùå No</span>'}</td><td style="color:var(--text2);font-size:.82rem">${e.note}</td></tr>`).join('')}
  </tbody></table></div>`;

  // Export button
  h+=`<div style="text-align:center;margin:16px 0"><button class="btn btn-ghost" onclick="exportReport()">üì• Download Report (Markdown)</button></div>`;

  $('results').innerHTML=h;
  // Store for export
  window._lastAnalysis=d;
}

function exportReport(){
  const d=window._lastAnalysis;if(!d)return;
  const{src,tgt,proj,srcC,tgtC,srcT,tgtT,bridges,feas,risk,ctrx}=d;
  let md=`# Migration Analysis: ${proj}\n## ${srcC?.name||src} ‚Üí ${tgtC?.name||tgt}\n*Generated by MigrateAI*\n\n`;
  md+=`## Feasibility: Grade ${feas.g} (${feas.s}/100)\n## Risk: ${risk.lv} (${risk.s}/100)\n## Bridge Routes: ${bridges.length}\n\n`;
  md+=`### Source: ${srcC?.name||src}\n- TVL: ${fmt(srcC?.tvl||0)}\n- 30d Change: ${srcT.c.toFixed(1)}%\n\n`;
  md+=`### Target: ${tgtC?.name||tgt}\n- TVL: ${fmt(tgtC?.tvl||0)}\n- 30d Change: ${tgtT.c.toFixed(1)}%\n\n`;
  md+=`### Bridges\n${bridges.map(b=>`- ${b.name} (${b.type}) ‚Äî Risk: ${b.risk}`).join('\n')}\n\n`;
  md+=`### Challenges\n${risk.ch.map(c=>`- **[${c.sev}] ${c.title}**: ${c.d}`).join('\n')}\n\n`;
  if(ctrx){md+=`### Contract Complexity: ${ctrx.ov}/10 (~${ctrx.wk} weeks)\n${ctrx.pats.map(p=>`- ${p.type} ‚Üí ${p.to} (${p.d}/10)`).join('\n')}\n\n`}
  md+=`---\n*Generated by MigrateAI ‚Äî https://github.com/jeanclawdbotdamn/migrateai*\n`;
  download(`migrateai-${src}-to-${tgt}.md`,md,'text/markdown');
}

function download(name,content,type='text/plain'){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([content],{type}));
  a.download=name;a.click();URL.revokeObjectURL(a.href);
}

// =============================================================================
// DYING CHAINS SCANNER
// =============================================================================
async function scanDying(){
  const btn=$('scanBtn');btn.disabled=true;btn.textContent='‚è≥ Scanning‚Ä¶';
  $('scanLoader').classList.add('on');$('scanResults').innerHTML='';

  try{
    const chains=allChainData.length?allChainData:await fetch('https://api.llama.fi/v2/chains').then(r=>r.json());
    // Filter chains with >$1M TVL, then get history for top by TVL
    const candidates=chains.filter(c=>(c.tvl||0)>1e6).sort((a,b)=>(b.tvl||0)-(a.tvl||0)).slice(0,80);

    // Batch fetch historical data (in groups of 10 to be polite)
    const results=[];
    for(let i=0;i<candidates.length;i+=10){
      const batch=candidates.slice(i,i+10);
      const histories=await Promise.allSettled(batch.map(c=>
        fetch(`https://api.llama.fi/v2/historicalChainTvl/${encodeURIComponent(c.name)}`).then(r=>r.json())
      ));
      batch.forEach((c,j)=>{
        if(histories[j].status==='fulfilled'){
          const t=trend(histories[j].value);
          if(t.t==='declining'){
            results.push({name:c.name,tvl:c.tvl||0,change:t.c,symbol:c.tokenSymbol||''});
          }
        }
      });
    }

    results.sort((a,b)=>a.change-b.change);

    $('scanLoader').classList.remove('on');
    if(!results.length){
      $('scanResults').innerHTML='<div class="card"><p>No significantly declining chains found! The ecosystem looks healthy. üéâ</p></div>';
    } else {
      const maxAbsChange=Math.max(...results.map(r=>Math.abs(r.change)));
      $('scanResults').innerHTML=`<div class="card">
        <h3>üìâ Declining Chains (${results.length} found)</h3>
        <p style="color:var(--text2);margin-bottom:16px">Chains with &gt;$1M TVL and declining 30-day trend. Click to analyze migration to Solana.</p>
        <table class="dying-table"><thead><tr><th>Chain</th><th>TVL</th><th>30d Change</th><th>Decline</th><th></th></tr></thead><tbody>
        ${results.slice(0,30).map(r=>{
          const pct=Math.min(Math.abs(r.change)/maxAbsChange,1)*100;
          return`<tr>
            <td class="chain-name">${r.name} ${r.symbol?`<span style="color:var(--text3);font-size:.75rem">(${r.symbol})</span>`:''}</td>
            <td>${fmt(r.tvl)}</td>
            <td style="color:var(--red)">${r.change.toFixed(1)}%</td>
            <td><div class="bar-bg"><div class="bar-fill" style="width:${pct}%;background:var(--red)"></div></div></td>
            <td><button class="btn btn-sm btn-outline" onclick="quickAnalyze('${r.name.toLowerCase()}')">Analyze ‚Üí</button></td>
          </tr>`;
        }).join('')}
        </tbody></table>
      </div>`;
    }
  }catch(e){
    $('scanLoader').classList.remove('on');
    $('scanResults').innerHTML=`<div class="card" style="border-color:var(--red)"><p>Scan failed: ${e.message}</p></div>`;
  }
  btn.disabled=false;btn.textContent='üîç Scan for Declining Chains';
}

function quickAnalyze(chain){
  // Switch to analyze tab, set source chain, target Solana
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(t=>t.classList.remove('active'));
  document.querySelector('[data-tab="analyze"]').classList.add('active');
  $('tab-analyze').classList.add('active');

  // Try to match the chain name in dropdown
  const sel=$('srcChain');
  const opts=Array.from(sel.options);
  const match=opts.find(o=>o.value===chain)||opts.find(o=>chain.includes(o.value));
  if(match)sel.value=match.value;
  $('tgtChain').value='solana';

  window.scrollTo({top:0,behavior:'smooth'});
}

// =============================================================================
// CODE GENERATOR
// =============================================================================
function generateCode(){
  const name=$('cgName').value.trim()||'my_project';
  const source=$('cgSource').value.trim()||'Ethereum';
  const types=Array.from(cgContracts);
  if(!types.length){alert('Select at least one contract type');return}

  const slug=name.toLowerCase().replace(/\s+/g,'_').replace(/-/g,'_');
  const files={};

  // Anchor.toml
  files['Anchor.toml']=`[toolchain]\nanchor_version = "0.31.1"\n\n[features]\nresolution = true\nskip-lint = false\n\n[programs.localnet]\n${slug} = "Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS"\n\n[programs.devnet]\n${slug} = "Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS"\n\n[registry]\nurl = "https://api.apr.dev"\n\n[provider]\ncluster = "Localnet"\nwallet = "~/.config/solana/id.json"\n\n[scripts]\ntest = "yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/**/*.ts"`;

  // Cargo.toml
  files[`programs/${slug}/Cargo.toml`]=`[package]\nname = "${slug}"\nversion = "0.1.0"\ndescription = "Migrated from ${source} using MigrateAI"\nedition = "2021"\n\n[lib]\ncrate-type = ["cdylib", "lib"]\nname = "${slug}"\n\n[features]\nno-entrypoint = []\nno-idl = []\nno-log-ix-name = []\ncpi = ["no-entrypoint"]\ndefault = []\n\n[dependencies]\nanchor-lang = "0.31.1"\nanchor-spl = "0.31.1"`;

  // lib.rs
  let libRs=`//! ${slug} ‚Äî Solana program migrated from ${source}\n//! Generated by MigrateAI\n\nuse anchor_lang::prelude::*;\nuse anchor_spl::token::{self, Token, TokenAccount, Mint, Transfer, MintTo, Burn};\n\ndeclare_id!("Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS");\n\n#[program]\npub mod ${slug} {\n    use super::*;\n`;

  types.forEach(t=>{
    const code=CODEGEN[t];
    if(code)libRs+=code.handler;
    else libRs+=`\n    pub fn initialize_${t.toLowerCase().replace(/[^a-z0-9]/g,'_')}(ctx: Context<Initialize>) -> Result<()> {\n        // TODO: Implement\n        Ok(())\n    }\n`;
  });
  libRs+=`}\n`;

  // Add account structs
  types.forEach(t=>{
    const code=CODEGEN[t];
    if(code)libRs+='\n'+code.accounts;
  });

  // Add events and errors
  libRs+='\n// Events\n';
  types.forEach(t=>{const code=CODEGEN[t];if(code&&code.events)libRs+=code.events});
  libRs+=`\n#[error_code]\npub enum ErrorCode {\n    #[msg("Arithmetic overflow")]\n    Overflow,\n    #[msg("Slippage exceeded")]\n    SlippageExceeded,\n    #[msg("Invalid fee")]\n    InvalidFee,\n    #[msg("Unauthorized")]\n    Unauthorized,\n}\n`;

  files[`programs/${slug}/src/lib.rs`]=libRs;

  // Tests
  files[`tests/${slug}.ts`]=`import * as anchor from "@coral-xyz/anchor";\nimport { Program } from "@coral-xyz/anchor";\nimport { expect } from "chai";\n\ndescribe("${slug}", () => {\n  const provider = anchor.AnchorProvider.env();\n  anchor.setProvider(provider);\n\n  it("Initializes", async () => {\n    console.log("Program ready");\n  });\n});`;

  // package.json
  files['package.json']=JSON.stringify({scripts:{test:"anchor test"},dependencies:{"@coral-xyz/anchor":"^0.31.1","@solana/web3.js":"^1.95.0","@solana/spl-token":"^0.4.0"},devDependencies:{chai:"^4.3.4",mocha:"^9.0.3","ts-mocha":"^10.0.0",typescript:"^5.0.0"}},null,2);

  // Migration guide
  files['MIGRATION.md']=`# Migration Guide: ${name}\n## ${source} ‚Üí Solana\n\n| EVM | Solana |\n|---|---|\n| Contract storage | Account data (PDAs) |\n| msg.sender | Signer constraint |\n| require() | Anchor constraints |\n| Events | emit! macro |\n| block.timestamp | Clock sysvar |\n| mapping | PDA per key |\n\n## Getting Started\n\n\`\`\`bash\nyarn install\nanchor build\nanchor test\nanchor deploy --provider.cluster devnet\n\`\`\`\n\n---\n*Generated by MigrateAI*`;

  // NTT config if bridge/token types
  if(types.some(t=>['ERC-20','ERC-721','Bridge'].includes(t))){
    files['ntt/deployment.json']=JSON.stringify({network:"Mainnet",chains:{[source.toLowerCase()]:{mode:"burning",manager:"<DEPLOY>",token:"<TOKEN>"},solana:{mode:"burning",manager:"<DEPLOY>",token:"<SPL_MINT>"}},rateLimits:{outbound:"1000000000000",inbound:"1000000000000"}},null,2);
  }

  generatedFiles=files;
  $('dlBtn').disabled=false;

  // Render preview
  const mainFile=`programs/${slug}/src/lib.rs`;
  const highlighted=highlightRust(files[mainFile]);

  let h=`<div class="card" style="margin-top:24px"><h3>‚úÖ Generated ${Object.keys(files).length} files</h3>
  <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px">
    ${Object.keys(files).sort().map(f=>`<span class="tag on" style="cursor:default;font-size:.75rem;font-family:'JetBrains Mono',monospace">üìÑ ${f}</span>`).join('')}
  </div>

  <div class="code-wrap">
    <div class="code-bar"><span class="filename">${mainFile}</span><span class="lang">Rust / Anchor</span></div>
    <pre class="code">${highlighted}</pre>
  </div>

  <div class="code-wrap">
    <div class="code-bar"><span class="filename">MIGRATION.md</span><span class="lang">Markdown</span></div>
    <pre class="code">${escHtml(files['MIGRATION.md'])}</pre>
  </div>

  <div style="text-align:center;margin-top:16px"><button class="btn btn-primary" style="max-width:300px" onclick="downloadCode()">üì• Download ZIP</button></div>
  </div>`;

  $('codeResults').innerHTML=h;
}

function highlightRust(code){
  let h=escHtml(code);
  // Keywords
  h=h.replace(/\b(use|pub|mod|fn|let|mut|const|struct|enum|impl|self|super|crate|if|else|return|match|for|while|loop|break|continue|as|in|ref|move|type|where|async|await|trait|static|extern|unsafe)\b/g,'<span class="kw">$1</span>');
  // Types
  h=h.replace(/\b(Result|Ok|Err|Some|None|Option|String|Vec|u8|u16|u32|u64|u128|i8|i16|i32|i64|i128|bool|Pubkey|Account|Signer|Program|Context|Clock|Rent)\b/g,'<span class="ty">$1</span>');
  // Strings
  h=h.replace(/"([^"]*?)"/g,'<span class="str">"$1"</span>');
  // Comments
  h=h.replace(/(\/\/.*)/g,'<span class="cm">$1</span>');
  // Attributes
  h=h.replace(/(#\[[\w()=, :"]*?\])/g,'<span class="at">$1</span>');
  // Numbers
  h=h.replace(/\b(\d+)\b/g,'<span class="num">$1</span>');
  return h;
}

function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

async function downloadCode(){
  if(!generatedFiles)return;
  // Simple ZIP implementation (store method, no compression ‚Äî keeps it dependency-free)
  const files=Object.entries(generatedFiles);
  const enc=new TextEncoder();

  // Use JSZip-like approach with Blob
  // Since we want zero deps, create a simple tar-like concatenation or just multi-file download
  // Actually, let's create individual file downloads packaged as a single blob
  // Simplest: download as a shell script that creates the files

  let script='#!/bin/bash\n# MigrateAI Generated Project\n# Run: bash setup.sh\n\nset -e\n\n';
  for(const [path,content] of files){
    const dir=path.includes('/')?path.substring(0,path.lastIndexOf('/')):'';
    if(dir)script+=`mkdir -p "${dir}"\n`;
    // Escape content for heredoc
    const escaped=content.replace(/\\/g,'\\\\').replace(/\$/g,'\\$');
    script+=`cat > "${path}" << 'MIGRATEAI_EOF'\n${content}\nMIGRATEAI_EOF\n\n`;
  }
  script+='echo "‚úÖ Project scaffolded! Run: yarn install && anchor build"\n';

  download(`migrateai-${$('cgName').value||'project'}.sh`,script,'text/x-shellscript');
}

// Code generation templates
const CODEGEN={
  "ERC-20":{
    handler:`
    /// Initialize token mint (EVM: constructor)
    pub fn initialize_token(ctx: Context<InitToken>, decimals: u8) -> Result<()> {
        let config = &mut ctx.accounts.config;
        config.authority = ctx.accounts.authority.key();
        config.mint = ctx.accounts.mint.key();
        config.total_supply = 0;
        Ok(())
    }

    /// Mint tokens (EVM: _mint)
    pub fn mint_tokens(ctx: Context<MintTokens>, amount: u64) -> Result<()> {
        let config = &mut ctx.accounts.config;
        config.total_supply = config.total_supply.checked_add(amount)
            .ok_or(ErrorCode::Overflow)?;
        let seeds = &[b"config".as_ref(), &[ctx.bumps.config]];
        token::mint_to(
            CpiContext::new_with_signer(
                ctx.accounts.token_program.to_account_info(),
                MintTo {
                    mint: ctx.accounts.mint.to_account_info(),
                    to: ctx.accounts.dest.to_account_info(),
                    authority: ctx.accounts.config.to_account_info(),
                },
                &[seeds],
            ),
            amount,
        )?;
        emit!(TokensMinted { to: ctx.accounts.dest.key(), amount });
        Ok(())
    }
`,
    accounts:`
#[derive(Accounts)]
pub struct InitToken<'info> {
    #[account(mut)]
    pub authority: Signer<'info>,
    #[account(init, payer = authority, space = 8 + 32 + 32 + 8, seeds = [b"config"], bump)]
    pub config: Account<'info, TokenConfig>,
    #[account(init, payer = authority, mint::decimals = 9, mint::authority = config)]
    pub mint: Account<'info, Mint>,
    pub token_program: Program<'info, Token>,
    pub system_program: Program<'info, System>,
    pub rent: Sysvar<'info, Rent>,
}

#[derive(Accounts)]
pub struct MintTokens<'info> {
    pub authority: Signer<'info>,
    #[account(mut, seeds = [b"config"], bump, has_one = authority)]
    pub config: Account<'info, TokenConfig>,
    #[account(mut)]
    pub mint: Account<'info, Mint>,
    #[account(mut)]
    pub dest: Account<'info, TokenAccount>,
    pub token_program: Program<'info, Token>,
}

#[account]
pub struct TokenConfig {
    pub authority: Pubkey,
    pub mint: Pubkey,
    pub total_supply: u64,
}
`,
    events:`#[event]\npub struct TokensMinted { pub to: Pubkey, pub amount: u64 }\n`,
  },
  "AMM/DEX":{
    handler:`
    /// Initialize liquidity pool (EVM: createPair)
    pub fn init_pool(ctx: Context<InitPool>, fee_bps: u16) -> Result<()> {
        require!(fee_bps <= 10000, ErrorCode::InvalidFee);
        let pool = &mut ctx.accounts.pool;
        pool.token_a_mint = ctx.accounts.token_a_mint.key();
        pool.token_b_mint = ctx.accounts.token_b_mint.key();
        pool.fee_bps = fee_bps;
        pool.total_lp = 0;
        pool.bump = ctx.bumps.pool;
        emit!(PoolCreated { pool: pool.key(), fee_bps });
        Ok(())
    }

    /// Swap tokens (EVM: swapExactTokensForTokens)
    pub fn swap(ctx: Context<SwapTokens>, amount_in: u64, min_out: u64, a_to_b: bool) -> Result<()> {
        let pool = &ctx.accounts.pool;
        let r_in = if a_to_b { ctx.accounts.vault_a.amount } else { ctx.accounts.vault_b.amount };
        let r_out = if a_to_b { ctx.accounts.vault_b.amount } else { ctx.accounts.vault_a.amount };

        // Constant product: x * y = k
        let fee = 10000u128 - pool.fee_bps as u128;
        let amt_fee = (amount_in as u128) * fee;
        let num = amt_fee * (r_out as u128);
        let den = (r_in as u128) * 10000 + amt_fee;
        let amount_out = (num / den) as u64;

        require!(amount_out >= min_out, ErrorCode::SlippageExceeded);
        // TODO: Execute transfers via CPI
        emit!(Swapped { user: ctx.accounts.user.key(), amount_in, amount_out, a_to_b });
        Ok(())
    }
`,
    accounts:`
#[derive(Accounts)]
pub struct InitPool<'info> {
    #[account(mut)]
    pub authority: Signer<'info>,
    #[account(init, payer = authority, space = 8 + 32*2 + 2 + 8 + 1,
        seeds = [b"pool", token_a_mint.key().as_ref(), token_b_mint.key().as_ref()], bump)]
    pub pool: Account<'info, Pool>,
    pub token_a_mint: Account<'info, Mint>,
    pub token_b_mint: Account<'info, Mint>,
    pub system_program: Program<'info, System>,
}

#[derive(Accounts)]
pub struct SwapTokens<'info> {
    #[account(mut)]
    pub user: Signer<'info>,
    #[account(mut)]
    pub pool: Account<'info, Pool>,
    #[account(mut)]
    pub vault_a: Account<'info, TokenAccount>,
    #[account(mut)]
    pub vault_b: Account<'info, TokenAccount>,
    #[account(mut)]
    pub user_in: Account<'info, TokenAccount>,
    #[account(mut)]
    pub user_out: Account<'info, TokenAccount>,
    pub token_program: Program<'info, Token>,
}

#[account]
pub struct Pool {
    pub token_a_mint: Pubkey,
    pub token_b_mint: Pubkey,
    pub fee_bps: u16,
    pub total_lp: u64,
    pub bump: u8,
}
`,
    events:`#[event]\npub struct PoolCreated { pub pool: Pubkey, pub fee_bps: u16 }\n#[event]\npub struct Swapped { pub user: Pubkey, pub amount_in: u64, pub amount_out: u64, pub a_to_b: bool }\n`,
  },
  "Staking":{
    handler:`
    /// Initialize staking pool (EVM: constructor)
    pub fn init_staking(ctx: Context<InitStaking>, reward_rate: u64) -> Result<()> {
        let pool = &mut ctx.accounts.pool;
        pool.authority = ctx.accounts.authority.key();
        pool.reward_rate = reward_rate;
        pool.total_staked = 0;
        pool.last_update = Clock::get()?.unix_timestamp;
        Ok(())
    }

    /// Stake tokens (EVM: stake(uint256))
    pub fn stake(ctx: Context<StakeTokens>, amount: u64) -> Result<()> {
        let pool = &mut ctx.accounts.pool;
        pool.total_staked = pool.total_staked.checked_add(amount)
            .ok_or(ErrorCode::Overflow)?;
        pool.last_update = Clock::get()?.unix_timestamp;
        // TODO: Transfer via CPI
        emit!(Staked { user: ctx.accounts.user.key(), amount });
        Ok(())
    }
`,
    accounts:`
#[derive(Accounts)]
pub struct InitStaking<'info> {
    #[account(mut)]
    pub authority: Signer<'info>,
    #[account(init, payer = authority, space = 8 + 32 + 8 + 8 + 8,
        seeds = [b"staking"], bump)]
    pub pool: Account<'info, StakingPool>,
    pub system_program: Program<'info, System>,
}

#[derive(Accounts)]
pub struct StakeTokens<'info> {
    #[account(mut)]
    pub user: Signer<'info>,
    #[account(mut, seeds = [b"staking"], bump)]
    pub pool: Account<'info, StakingPool>,
    pub token_program: Program<'info, Token>,
}

#[account]
pub struct StakingPool {
    pub authority: Pubkey,
    pub reward_rate: u64,
    pub total_staked: u64,
    pub last_update: i64,
}
`,
    events:`#[event]\npub struct Staked { pub user: Pubkey, pub amount: u64 }\n`,
  },
  "Governance/DAO":{
    handler:`
    /// Create proposal (EVM: propose())
    pub fn create_proposal(ctx: Context<CreateProposal>, title: String, voting_period: i64) -> Result<()> {
        let prop = &mut ctx.accounts.proposal;
        let clock = Clock::get()?;
        prop.proposer = ctx.accounts.proposer.key();
        prop.start_time = clock.unix_timestamp;
        prop.end_time = clock.unix_timestamp + voting_period;
        prop.yes_votes = 0;
        prop.no_votes = 0;
        Ok(())
    }
`,
    accounts:`
#[derive(Accounts)]
pub struct CreateProposal<'info> {
    #[account(mut)]
    pub proposer: Signer<'info>,
    #[account(init, payer = proposer, space = 8 + 32 + 8*4)]
    pub proposal: Account<'info, Proposal>,
    pub system_program: Program<'info, System>,
}

#[account]
pub struct Proposal {
    pub proposer: Pubkey,
    pub start_time: i64,
    pub end_time: i64,
    pub yes_votes: u64,
    pub no_votes: u64,
}
`,
    events:'',
  },
  "Oracle Consumer":{
    handler:`
    /// Read price from Pyth (EVM: Chainlink latestRoundData)
    pub fn read_price(ctx: Context<ReadPrice>) -> Result<()> {
        // Pyth price account passed as remaining account
        // let price = pyth_sdk_solana::load_price_feed(&ctx.accounts.price_feed)?;
        msg!("Price read from Pyth oracle");
        Ok(())
    }
`,
    accounts:`
#[derive(Accounts)]
pub struct ReadPrice<'info> {
    /// CHECK: Pyth price feed account
    pub price_feed: AccountInfo<'info>,
}
`,
    events:'',
  },
};

// =============================================================================
// BOOT
// =============================================================================
init();
</script>
</body>
</html>
